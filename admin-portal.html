<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - King Solomon Junior School</title>
    
    <!-- Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="css/modern-enhancements.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #dc2626;
            --primary-dark: #b91c1c;
            --secondary: #f59e0b;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --border: #e2e8f0;
            --sidebar-width: 280px;
        }

        body.dark-mode {
            --bg-light: #0f172a;
            --bg-white: #1e293b;
            --text-dark: #f1f5f9;
            --text-gray: #cbd5e1;
            --border: #334155;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(180deg, var(--primary), var(--primary-dark));
            color: white;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 20px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .school-logo {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .school-info h1 {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .school-info p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: 20px 0;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: white;
        }

        .nav-item.active .nav-link {
            background: rgba(255,255,255,0.2);
            border-left-color: white;
        }

        .nav-link i {
            width: 24px;
            margin-right: 15px;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            cursor: pointer;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }

        .top-bar {
            background: var(--bg-white);
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .content-area {
            padding: 30px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .stat-card {
            background: var(--bg-white);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }

        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: var(--text-gray);
            font-size: 0.95rem;
        }

        .widget {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }

        body.dark-mode .widget {
            background: var(--bg-white);
        }

        .widget-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .widget-title {
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        body.dark-mode .chart-card {
            background: var(--bg-white);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modern-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
        }

        .modern-table thead th {
            background: var(--bg-light);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-gray);
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .modern-table tbody tr {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        body.dark-mode .modern-table tbody tr {
            background: var(--bg-white);
        }

        .modern-table tbody tr:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .modern-table tbody td {
            padding: 15px;
            border: none;
        }

        .modern-table tbody tr td:first-child {
            border-radius: 8px 0 0 8px;
        }

        .modern-table tbody tr td:last-child {
            border-radius: 0 8px 8px 0;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .quick-action {
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        body.dark-mode .quick-action {
            background: var(--bg-white);
        }

        .quick-action:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.2);
        }

        .quick-action i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
            display: block;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .stats-grid, .charts-grid, .quick-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleSidebar()" style="display: none; position: fixed; top: 20px; left: 20px; z-index: 1001; background: var(--primary); color: white; border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer;">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-section">
                <div class="school-logo">👨‍💼</div>
                <div class="school-info">
                    <h1>KS Junior</h1>
                    <p>Admin Portal</p>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <ul class="nav-menu">
                <li class="nav-item active" data-section="dashboard">
                    <a class="nav-link">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item" data-section="approvals">
                    <a class="nav-link">
                        <i class="fas fa-check-circle"></i>
                        <span>Marks Approval</span>
                        <span class="notification-badge" style="margin-left: auto; background: #fbbf24; color: #1e293b; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 700;">3</span>
                    </a>
                </li>
                <li class="nav-item" data-section="results">
                    <a class="nav-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>Generate Results</span>
                    </a>
                </li>
                <li class="nav-item" data-section="applications">
                    <a class="nav-link">
                        <i class="fas fa-file-alt"></i>
                        <span>Applications</span>
                        <span class="notification-badge" style="margin-left: auto; background: #fbbf24; color: #1e293b; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 700;">5</span>
                    </a>
                </li>
                <li class="nav-item" data-section="students">
                    <a class="nav-link">
                        <i class="fas fa-user-graduate"></i>
                        <span>Students</span>
                    </a>
                </li>
                <li class="nav-item" data-section="teachers">
                    <a class="nav-link">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span>Teachers</span>
                    </a>
                </li>
                <li class="nav-item" data-section="classes">
                    <a class="nav-link">
                        <i class="fas fa-school"></i>
                        <span>Classes</span>
                    </a>
                </li>
                <li class="nav-item" data-section="fees">
                    <a class="nav-link">
                        <i class="fas fa-money-bill"></i>
                        <span>Fees</span>
                    </a>
                </li>
                <li class="nav-item" data-section="reports">
                    <a class="nav-link">
                        <i class="fas fa-file-alt"></i>
                        <span>Reports</span>
                    </a>
                </li>
                <li class="nav-item" data-section="analytics">
                    <a class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <div class="user-info" onclick="showUserMenu()">
                <div class="user-avatar">AD</div>
                <div class="user-details">
                    <h4>Admin</h4>
                    <p>System Administrator</p>
                </div>
                <i class="fas fa-chevron-up" style="margin-left: auto;"></i>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <h1 class="page-title" id="pageTitle">Dashboard</h1>
            <div style="display: flex; gap: 15px; align-items: center;">
                <button class="notification-btn" onclick="showNotifications()" style="position: relative; background: var(--bg-light); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer;">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" style="position: absolute; top: -5px; right: -5px; background: #dc2626; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 0.7rem; display: flex; align-items: center; justify-content: center;">5</span>
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Section -->
            <div class="content-section active" id="dashboard-section">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card" data-aos="zoom-in">
                        <div class="stat-icon">👥</div>
                        <div>
                            <div class="stat-value">340</div>
                            <div class="stat-label">Total Students</div>
                            <small style="color: var(--text-gray); display: block; margin-top: 5px;">Across all classes</small>
                        </div>
                    </div>

                    <div class="stat-card" data-aos="zoom-in" data-aos-delay="100">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">
                            👨‍🏫
                        </div>
                        <div>
                            <div class="stat-value">25</div>
                            <div class="stat-label">Teachers</div>
                            <small style="color: var(--text-gray); display: block; margin-top: 5px;">Active staff</small>
                        </div>
                    </div>

                    <div class="stat-card" data-aos="zoom-in" data-aos-delay="200">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #0891b2, #0e7490);">
                            📝
                        </div>
                        <div>
                            <div class="stat-value">5</div>
                            <div class="stat-label">New Applications</div>
                            <small style="color: var(--text-gray); display: block; margin-top: 5px;">Awaiting review</small>
                        </div>
                    </div>

                    <div class="stat-card" data-aos="zoom-in" data-aos-delay="300">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                            ⏳
                        </div>
                        <div>
                            <div class="stat-value">3</div>
                            <div class="stat-label">Pending Approvals</div>
                            <small style="color: var(--text-gray); display: block; margin-top: 5px;">Marks awaiting review</small>
                        </div>
                    </div>

                    <div class="stat-card" data-aos="zoom-in" data-aos-delay="300">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #059669, #047857);">
                            💰
                        </div>
                        <div>
                            <div class="stat-value">2.5M</div>
                            <div class="stat-label">Fees Collected (KES)</div>
                            <small style="color: var(--text-gray); display: block; margin-top: 5px;">This term</small>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions" data-aos="fade-up">
                    <div class="quick-action" onclick="goToApplications()">
                        <i class="fas fa-inbox"></i>
                        <strong>Review Applications</strong>
                        <small style="color: var(--text-gray); display: block; margin-top: 5px;">5 new applications</small>
                    </div>
                    <div class="quick-action" onclick="goToApprovals()">
                        <i class="fas fa-check-circle"></i>
                        <strong>Approve Marks</strong>
                        <small style="color: var(--text-gray); display: block; margin-top: 5px;">3 pending</small>
                    </div>
                    <div class="quick-action" onclick="generateResults()">
                        <i class="fas fa-chart-bar"></i>
                        <strong>Generate Results</strong>
                        <small style="color: var(--text-gray); display: block; margin-top: 5px;">Class rankings</small>
                    </div>
                    <div class="quick-action" onclick="addStudent()">
                        <i class="fas fa-user-plus"></i>
                        <strong>Add Student</strong>
                        <small style="color: var(--text-gray); display: block; margin-top: 5px;">Direct admission</small>
                    </div>
                    <div class="quick-action" onclick="viewReports()">
                        <i class="fas fa-file-pdf"></i>
                        <strong>Reports</strong>
                        <small style="color: var(--text-gray); display: block; margin-top: 5px;">Download reports</small>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-grid">
                    <div class="chart-card" data-aos="fade-up">
                        <h3 class="chart-title">
                            <i class="fas fa-chart-line"></i>
                            Enrollment Trend
                        </h3>
                        <div style="height: 300px;">
                            <canvas id="enrollmentChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card" data-aos="fade-up" data-aos-delay="100">
                        <h3 class="chart-title">
                            <i class="fas fa-money-bill-wave"></i>
                            Fee Collection
                        </h3>
                        <div style="height: 300px;">
                            <canvas id="feeCollectionChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card" data-aos="fade-up" data-aos-delay="200">
                        <h3 class="chart-title">
                            <i class="fas fa-chart-pie"></i>
                            Overall Performance
                        </h3>
                        <div style="height: 300px;">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card" data-aos="fade-up" data-aos-delay="300">
                        <h3 class="chart-title">
                            <i class="fas fa-users"></i>
                            Class Distribution
                        </h3>
                        <div style="height: 300px;">
                            <canvas id="classDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Applications Section -->
            <div class="content-section" id="applications-section">
                <div class="widget" data-aos="fade-up">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-inbox"></i>
                            New Applications
                        </h3>
                        <span class="badge-modern badge-warning">
                            <i class="fas fa-clock"></i> 5 Pending
                        </span>
                    </div>
                    
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>Application ID</th>
                                <th>Student Name</th>
                                <th>Grade Applied</th>
                                <th>Parent Contact</th>
                                <th>Submitted</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>APP2025001</strong></td>
                                <td>Michael Johnson</td>
                                <td>Grade 5</td>
                                <td>+254 712 345 678</td>
                                <td>Oct 4, 2025</td>
                                <td><span class="badge-modern badge-warning"><i class="fas fa-clock"></i> Pending</span></td>
                                <td>
                                    <button class="btn-enhanced" style="background: var(--primary); color: white; padding: 8px 16px;" onclick="reviewApplication('APP2025001', 'Michael Johnson', 'Grade 5', '+254 712 345 678', 'mjohnson@email.com')">
                                        <i class="fas fa-eye"></i> Review
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>APP2025002</strong></td>
                                <td>Emma Williams</td>
                                <td>Grade 3</td>
                                <td>+254 723 456 789</td>
                                <td>Oct 3, 2025</td>
                                <td><span class="badge-modern badge-warning"><i class="fas fa-clock"></i> Pending</span></td>
                                <td>
                                    <button class="btn-enhanced" style="background: var(--primary); color: white; padding: 8px 16px;" onclick="reviewApplication('APP2025002', 'Emma Williams', 'Grade 3', '+254 723 456 789', 'ewilliams@email.com')">
                                        <i class="fas fa-eye"></i> Review
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Interview Scheduled -->
                <div class="widget" data-aos="fade-up">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-calendar-check"></i>
                            Interview Scheduled
                        </h3>
                    </div>
                    
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>Application ID</th>
                                <th>Student Name</th>
                                <th>Interview Date</th>
                                <th>Time</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>APP2025003</strong></td>
                                <td>David Brown</td>
                                <td>Oct 8, 2025</td>
                                <td>10:00 AM</td>
                                <td><span class="badge-modern badge-info"><i class="fas fa-calendar"></i> Scheduled</span></td>
                                <td>
                                    <button class="btn-enhanced" style="background: #059669; color: white; padding: 8px 16px;" onclick="conductInterview('APP2025003', 'David Brown')">
                                        <i class="fas fa-check"></i> Mark Result
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Approved Applications -->
                <div class="widget" data-aos="fade-up">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-check-circle"></i>
                            Approved & Admitted
                        </h3>
                    </div>
                    
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>Application ID</th>
                                <th>Student Name</th>
                                <th>Admission No</th>
                                <th>Class Assigned</th>
                                <th>Approved Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>APP2025004</strong></td>
                                <td>Lisa Anderson</td>
                                <td><strong>2025010</strong></td>
                                <td>Grade 4 - Stream A</td>
                                <td>Oct 1, 2025</td>
                                <td><span class="badge-modern badge-success"><i class="fas fa-check"></i> Admitted</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Marks Approval Section -->
            <div class="content-section" id="approvals-section">
                <div class="widget" data-aos="fade-up">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-clipboard-check"></i>
                            Marks Pending Approval
                        </h3>
                        <span class="badge-modern badge-warning">
                            <i class="fas fa-clock"></i> 3 Pending
                        </span>
                    </div>
                    
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>Exam</th>
                                <th>Class</th>
                                <th>Subject</th>
                                <th>Teacher</th>
                                <th>Submitted</th>
                                <th>Students</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>End Term 2 - 2025</strong></td>
                                <td>STD 8 - Stream A</td>
                                <td>Mathematics</td>
                                <td>Mrs. Johnson</td>
                                <td>Oct 4, 2025 2:30 PM</td>
                                <td><span class="badge-modern badge-info">28 students</span></td>
                                <td>
                                    <button class="btn-enhanced" style="background: var(--primary); color: white; padding: 8px 16px;" onclick="reviewMarks(1, 'End Term 2', 'STD 8A', 'Mathematics', 'Mrs. Johnson')">
                                        <i class="fas fa-eye"></i> Review
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>End Term 2 - 2025</strong></td>
                                <td>STD 6 - Stream B</td>
                                <td>Science</td>
                                <td>Mr. Davis</td>
                                <td>Oct 3, 2025 4:15 PM</td>
                                <td><span class="badge-modern badge-info">27 students</span></td>
                                <td>
                                    <button class="btn-enhanced" style="background: var(--primary); color: white; padding: 8px 16px;" onclick="reviewMarks(2, 'End Term 2', 'STD 6B', 'Science', 'Mr. Davis')">
                                        <i class="fas fa-eye"></i> Review
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Mid-Term - Term 2</strong></td>
                                <td>STD 7 - Stream B</td>
                                <td>Mathematics</td>
                                <td>Mrs. Johnson</td>
                                <td>Oct 1, 2025 11:20 AM</td>
                                <td><span class="badge-modern badge-info">30 students</span></td>
                                <td>
                                    <button class="btn-enhanced" style="background: var(--primary); color: white; padding: 8px 16px;" onclick="reviewMarks(3, 'Mid-Term', 'STD 7B', 'Mathematics', 'Mrs. Johnson')">
                                        <i class="fas fa-eye"></i> Review
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Approved Marks -->
                <div class="widget" data-aos="fade-up">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-check-double"></i>
                            Recently Approved
                        </h3>
                    </div>
                    
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>Exam</th>
                                <th>Class</th>
                                <th>Subject</th>
                                <th>Teacher</th>
                                <th>Approved Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Mid-Term - Term 2</strong></td>
                                <td>STD 8 - Stream A</td>
                                <td>English</td>
                                <td>Ms. Williams</td>
                                <td>Sep 30, 2025</td>
                                <td><span class="badge-modern badge-success"><i class="fas fa-check"></i> Approved & Ranked</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Results Generation Section -->
            <div class="content-section" id="results-section">
                <div class="widget" data-aos="fade-up">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-chart-bar"></i>
                            Generate Class Results
                        </h3>
                    </div>
                    
                    <div style="background: #dbeafe; padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #0891b2;">
                        <strong style="display: block; margin-bottom: 10px;">
                            <i class="fas fa-info-circle"></i> How It Works:
                        </strong>
                        <ol style="margin-left: 20px; color: var(--text-gray); line-height: 1.8;">
                            <li>Teachers submit individual subject marks</li>
                            <li>You review and approve the marks here</li>
                            <li>Once all subjects are approved, generate results</li>
                            <li>System automatically calculates totals and rankings</li>
                            <li>Professional results sheets ready to print/export</li>
                        </ol>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Select Exam</label>
                            <select id="resultsExam" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border);">
                                <option value="">Choose Exam</option>
                                <option value="1">End Term 2 Exams - 2025</option>
                                <option value="2">Mid-Term Exams - Term 2</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Select Class</label>
                            <select id="resultsClass" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border);">
                                <option value="">Choose Class</option>
                                <option value="1">STD 8 - Stream A</option>
                                <option value="2">STD 7 - Stream B</option>
                                <option value="3">STD 6 - Stream B</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn-enhanced" style="background: var(--primary); color: white; font-size: 1.1rem; padding: 15px 30px;" onclick="generateClassResults()">
                        <i class="fas fa-chart-bar"></i> Generate Results Sheet
                    </button>
                </div>
            </div>

            <!-- Students Section -->
            <div class="content-section" id="students-section">
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-user-graduate"></i>
                            All Students (340)
                        </h3>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" placeholder="Search students..." style="padding: 10px 15px; border-radius: 8px; border: 1px solid var(--border); min-width: 250px;">
                        <button class="btn-enhanced" style="background: var(--primary); color: white;" onclick="addStudent()">
                            <i class="fas fa-user-plus"></i> Add Student
                        </button>
                        </div>
                    </div>
                    
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>Admission No</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Grade</th>
                                <th>Attendance</th>
                                <th>Fees Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>2025001</strong></td>
                                <td>John Smith</td>
                                <td>STD 8 - Stream A</td>
                                <td><span class="badge-modern badge-success">A- (92%)</span></td>
                                <td><span class="badge-modern badge-success">98%</span></td>
                                <td><span class="badge-modern badge-success">Paid</span></td>
                                <td>
                                    <button class="btn-enhanced" style="background: var(--primary); color: white; padding: 8px 16px;" onclick="viewStudentFull('John Smith', '2025001')">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>2025002</strong></td>
                                <td>Damaris Jaleny</td>
                                <td>STD 8 - Stream A</td>
                                <td><span class="badge-modern badge-success">A- (88%)</span></td>
                                <td><span class="badge-modern badge-success">100%</span></td>
                                <td><span class="badge-modern badge-warning">Partial</span></td>
                                <td>
                                    <button class="btn-enhanced" style="background: var(--primary); color: white; padding: 8px 16px;" onclick="viewStudentFull('Damaris Jaleny', '2025002')">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>2023045</strong></td>
                                <td>Sarah Smith</td>
                                <td>STD 6 - Stream B</td>
                                <td><span class="badge-modern badge-success">A (95%)</span></td>
                                <td><span class="badge-modern badge-warning">95%</span></td>
                                <td><span class="badge-modern badge-success">Paid</span></td>
                                <td>
                                    <button class="btn-enhanced" style="background: var(--primary); color: white; padding: 8px 16px;" onclick="viewStudentFull('Sarah Smith', '2023045')">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Teachers Section -->
            <div class="content-section" id="teachers-section">
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-chalkboard-teacher"></i>
                            All Teachers (25)
                        </h3>
                        <button class="btn-enhanced" style="background: var(--primary); color: white;" onclick="addTeacher()">
                            <i class="fas fa-user-plus"></i> Add Teacher
                        </button>
                    </div>
                    
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>Employee ID</th>
                                <th>Name</th>
                                <th>Subject</th>
                                <th>Classes</th>
                                <th>Students</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>TCH2025001</strong></td>
                                <td>Mrs. Mary Johnson</td>
                                <td>Mathematics</td>
                                <td>3 Classes</td>
                                <td>85 Students</td>
                                <td>
                                    <button class="btn-enhanced" style="background: var(--primary); color: white; padding: 8px 16px;" onclick="viewTeacher('Mrs. Johnson')">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>TCH2025002</strong></td>
                                <td>Mr. Robert Davis</td>
                                <td>Science</td>
                                <td>2 Classes</td>
                                <td>55 Students</td>
                                <td>
                                    <button class="btn-enhanced" style="background: var(--primary); color: white; padding: 8px 16px;" onclick="viewTeacher('Mr. Davis')">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>TCH2025003</strong></td>
                                <td>Ms. Jane Williams</td>
                                <td>English</td>
                                <td>4 Classes</td>
                                <td>110 Students</td>
                                <td>
                                    <button class="btn-enhanced" style="background: var(--primary); color: white; padding: 8px 16px;" onclick="viewTeacher('Ms. Williams')">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Classes Section -->
            <div class="content-section" id="classes-section">
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-school"></i>
                            All Classes
                        </h3>
                        <button class="btn-enhanced" style="background: var(--primary); color: white;" onclick="addClass()">
                            <i class="fas fa-plus"></i> Add Class
                        </button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #dc2626;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                <div>
                                    <h3 style="font-size: 1.5rem; margin-bottom: 5px;">STD 8</h3>
                                    <p style="color: var(--text-gray);">2 Streams (A, B)</p>
                                </div>
                                <span style="background: #dc2626; color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600;">85 Students</span>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                                <div>
                                    <small style="color: var(--text-gray);">Avg Grade</small>
                                    <div style="font-weight: 700; color: var(--primary);">A-</div>
                                </div>
                                <div>
                                    <small style="color: var(--text-gray);">Attendance</small>
                                    <div style="font-weight: 700; color: #059669;">97%</div>
                                </div>
                            </div>
                            <button class="btn-enhanced" style="background: var(--primary); color: white; width: 100%; margin-top: 15px; justify-content: center;" onclick="manageClass('STD 8')">
                                <i class="fas fa-cog"></i> Manage Class
                            </button>
                        </div>

                        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #059669;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                <div>
                                    <h3 style="font-size: 1.5rem; margin-bottom: 5px;">STD 7</h3>
                                    <p style="color: var(--text-gray);">2 Streams (A, B)</p>
                                </div>
                                <span style="background: #059669; color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600;">90 Students</span>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                                <div>
                                    <small style="color: var(--text-gray);">Avg Grade</small>
                                    <div style="font-weight: 700; color: #059669;">B+</div>
                                </div>
                                <div>
                                    <small style="color: var(--text-gray);">Attendance</small>
                                    <div style="font-weight: 700; color: #059669;">95%</div>
                                </div>
                            </div>
                            <button class="btn-enhanced" style="background: #059669; color: white; width: 100%; margin-top: 15px; justify-content: center;" onclick="manageClass('STD 7')">
                                <i class="fas fa-cog"></i> Manage Class
                            </button>
                        </div>

                        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid #0891b2;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                <div>
                                    <h3 style="font-size: 1.5rem; margin-bottom: 5px;">STD 6</h3>
                                    <p style="color: var(--text-gray);">2 Streams (A, B)</p>
                                </div>
                                <span style="background: #0891b2; color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600;">75 Students</span>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                                <div>
                                    <small style="color: var(--text-gray);">Avg Grade</small>
                                    <div style="font-weight: 700; color: #0891b2;">A-</div>
                                </div>
                                <div>
                                    <small style="color: var(--text-gray);">Attendance</small>
                                    <div style="font-weight: 700; color: #059669;">96%</div>
                                </div>
                            </div>
                            <button class="btn-enhanced" style="background: #0891b2; color: white; width: 100%; margin-top: 15px; justify-content: center;" onclick="manageClass('STD 6')">
                                <i class="fas fa-cog"></i> Manage Class
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fees Section -->
            <div class="content-section" id="fees-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #059669, #047857);">💰</div>
                        <div>
                            <div class="stat-value">2.5M</div>
                            <div class="stat-label">Collected (KES)</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">⏳</div>
                        <div>
                            <div class="stat-value">500K</div>
                            <div class="stat-label">Pending (KES)</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #dc2626, #b91c1c);">⚠️</div>
                        <div>
                            <div class="stat-value">15</div>
                            <div class="stat-label">Overdue Accounts</div>
                        </div>
                    </div>
                </div>

                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-money-bill-wave"></i>
                            Fee Management
                        </h3>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" placeholder="Search students..." style="padding: 10px 15px; border-radius: 8px; border: 1px solid var(--border); min-width: 250px;">
                            <button class="btn-enhanced" style="background: var(--primary); color: white;" onclick="addPayment()">
                                <i class="fas fa-plus"></i> Add Payment
                            </button>
                        </div>
                    </div>
                    
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Class</th>
                                <th>Total Fees</th>
                                <th>Paid</th>
                                <th>Balance</th>
                                <th>Status</th>
                                <th>Last Payment</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>John Smith</strong><br><small>KS001</small></td>
                                <td>STD 8 - Stream A</td>
                                <td>KES 30,000</td>
                                <td>KES 30,000</td>
                                <td>KES 0</td>
                                <td><span class="badge-modern badge-success">Paid</span></td>
                                <td>15 Jan 2024</td>
                                <td>
                                    <button class="btn-sm" onclick="viewPaymentHistory('KS001')" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                                        <i class="fas fa-history"></i> History
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Sarah Smith</strong><br><small>KS002</small></td>
                                <td>STD 6 - Stream B</td>
                                <td>KES 25,000</td>
                                <td>KES 20,000</td>
                                <td>KES 5,000</td>
                                <td><span class="badge-modern badge-warning">Partial</span></td>
                                <td>10 Jan 2024</td>
                                <td>
                                    <button class="btn-sm" onclick="viewPaymentHistory('KS002')" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                                        <i class="fas fa-history"></i> History
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Michael Johnson</strong><br><small>KS003</small></td>
                                <td>STD 7 - Stream A</td>
                                <td>KES 28,000</td>
                                <td>KES 15,000</td>
                                <td>KES 13,000</td>
                                <td><span class="badge-modern badge-warning">Partial</span></td>
                                <td>8 Jan 2024</td>
                                <td>
                                    <button class="btn-sm" onclick="viewPaymentHistory('KS003')" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                                        <i class="fas fa-history"></i> History
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Emily Davis</strong><br><small>KS004</small></td>
                                <td>STD 5 - Stream A</td>
                                <td>KES 22,000</td>
                                <td>KES 10,000</td>
                                <td>KES 12,000</td>
                                <td><span class="badge-modern badge-warning">Partial</span></td>
                                <td>5 Jan 2024</td>
                                <td>
                                    <button class="btn-sm" onclick="viewPaymentHistory('KS004')" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                                        <i class="fas fa-history"></i> History
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>David Wilson</strong><br><small>KS005</small></td>
                                <td>STD 4 - Stream B</td>
                                <td>KES 20,000</td>
                                <td>KES 5,000</td>
                                <td>KES 15,000</td>
                                <td><span class="badge-modern badge-warning">Partial</span></td>
                                <td>3 Jan 2024</td>
                                <td>
                                    <button class="btn-sm" onclick="viewPaymentHistory('KS005')" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                                        <i class="fas fa-history"></i> History
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Lisa Brown</strong><br><small>KS006</small></td>
                                <td>STD 3 - Stream A</td>
                                <td>KES 18,000</td>
                                <td>KES 0</td>
                                <td>KES 18,000</td>
                                <td><span class="badge-modern badge-danger">Overdue</span></td>
                                <td>-</td>
                                <td>
                                    <button class="btn-sm" onclick="viewPaymentHistory('KS006')" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                                        <i class="fas fa-history"></i> History
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="chart-card">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-line"></i>
                        Fee Collection Trend
                    </h3>
                    <div style="height: 300px;">
                        <canvas id="feesTrendChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div class="content-section" id="reports-section">
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">
                            <i class="fas fa-file-alt"></i>
                            Generate Reports
                        </h3>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); text-align: center; cursor: pointer; transition: all 0.3s ease;" onclick="generateReport('academic')">
                            <i class="fas fa-graduation-cap" style="font-size: 3rem; color: #dc2626; margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Academic Report</h4>
                            <p style="color: var(--text-gray); font-size: 0.9rem;">Student performance and grades</p>
                        </div>

                        <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); text-align: center; cursor: pointer; transition: all 0.3s ease;" onclick="generateStudentTranscript()">
                            <i class="fas fa-scroll" style="font-size: 3rem; color: #1e3a8a; margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Student Transcript</h4>
                            <p style="color: var(--text-gray); font-size: 0.9rem;">Individual academic transcript</p>
                        </div>

                        <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); text-align: center; cursor: pointer; transition: all 0.3s ease;" onclick="generateReport('attendance')">
                            <i class="fas fa-calendar-check" style="font-size: 3rem; color: #059669; margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Attendance Report</h4>
                            <p style="color: var(--text-gray); font-size: 0.9rem;">Student attendance records</p>
                        </div>

                        <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); text-align: center; cursor: pointer; transition: all 0.3s ease;" onclick="generateReport('financial')">
                            <i class="fas fa-money-bill-wave" style="font-size: 3rem; color: #f59e0b; margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Financial Report</h4>
                            <p style="color: var(--text-gray); font-size: 0.9rem;">Fee collection and payments</p>
                        </div>

                        <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); text-align: center; cursor: pointer; transition: all 0.3s ease;" onclick="generateReport('comprehensive')">
                            <i class="fas fa-file-pdf" style="font-size: 3rem; color: #8b5cf6; margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Comprehensive Report</h4>
                            <p style="color: var(--text-gray); font-size: 0.9rem;">Complete school overview</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div class="content-section" id="analytics-section">
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3 class="chart-title">
                            <i class="fas fa-chart-area"></i>
                            Performance by Class
                        </h3>
                        <div style="height: 300px;">
                            <canvas id="classPerformanceChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <h3 class="chart-title">
                            <i class="fas fa-user-check"></i>
                            Attendance Trends
                        </h3>
                        <div style="height: 300px;">
                            <canvas id="attendanceTrendChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="stats-grid" style="margin-top: 30px;">
                    <div class="stat-card">
                        <div class="stat-icon">📈</div>
                        <div>
                            <div class="stat-value">+12%</div>
                            <div class="stat-label">Performance Growth</div>
                            <small style="color: #059669; display: block; margin-top: 5px;">vs last term</small>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #059669, #047857);">✅</div>
                        <div>
                            <div class="stat-value">96%</div>
                            <div class="stat-label">School Attendance</div>
                            <small style="color: #059669; display: block; margin-top: 5px;">This month</small>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #0891b2, #0e7490);">🎯</div>
                        <div>
                            <div class="stat-value">95%</div>
                            <div class="stat-label">Pass Rate</div>
                            <small style="color: #059669; display: block; margin-top: 5px;">Overall</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/modern-enhancements.js"></script>

    <script>
        // Static Admin Portal (No Backend Required)
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize admin portal with demo data
            initializeAdminPortal();
        });

        function initializeAdminPortal() {
            // Load dashboard data
            loadDashboardData();
            
            // Setup navigation
            setupNavigation();
            
            // Setup user dropdown
            setupUserDropdown();
        }

        function loadDashboardData() {
            // Load demo data (no backend required)
            const demoStudents = [
                { id: 1, name: 'John Doe', class: 'Grade 5A', admission_number: 'STU001', status: 'active' },
                { id: 2, name: 'Jane Smith', class: 'Grade 3B', admission_number: 'STU002', status: 'active' },
                { id: 3, name: 'Mike Johnson', class: 'Grade 4A', admission_number: 'STU003', status: 'active' }
            ];
            
            const demoTeachers = [
                { id: 1, name: 'Ms. Sarah Wilson', subject: 'Mathematics', class: 'Grade 5A', status: 'active' },
                { id: 2, name: 'Mr. David Brown', subject: 'English', class: 'Grade 3B', status: 'active' },
                { id: 3, name: 'Dr. Emily Davis', subject: 'Science', class: 'Grade 4A', status: 'active' }
            ];
            
            const demoAnalytics = {
                total_students: 150,
                total_teachers: 25,
                total_classes: 12,
                attendance_rate: 95
            };

            updateStudentsTable(demoStudents);
            updateTeachersTable(demoTeachers);
            updateDashboardStats(demoAnalytics);
        }

        function updateStudentsTable(students) {
            const tbody = document.querySelector('#students-section tbody');
            if (!tbody) return;

            tbody.innerHTML = students.map(student => `
                <tr>
                    <td><strong>${student.first_name} ${student.last_name}</strong><br><small>${student.admission_number}</small></td>
                    <td>${student.class_name || 'N/A'}</td>
                    <td>${student.grade || 'N/A'}</td>
                    <td>${student.attendance_percentage || 0}%</td>
                    <td>
                        <button class="btn-sm" onclick="viewStudent('${student.id}')" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn-sm" onclick="editStudent('${student.id}')" style="background: #059669; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function updateTeachersTable(teachers) {
            const tbody = document.querySelector('#teachers-section tbody');
            if (!tbody) return;

            tbody.innerHTML = teachers.map(teacher => `
                <tr>
                    <td><strong>${teacher.first_name} ${teacher.last_name}</strong><br><small>${teacher.employee_number}</small></td>
                    <td>${teacher.subjects || 'N/A'}</td>
                    <td>${teacher.classes || 'N/A'}</td>
                    <td>${teacher.phone || 'N/A'}</td>
                    <td>
                        <button class="btn-sm" onclick="viewTeacher('${teacher.id}')" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn-sm" onclick="editTeacher('${teacher.id}')" style="background: #059669; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function updateDashboardStats(stats) {
            // Update stats cards
            const statCards = document.querySelectorAll('.stat-card');
            if (statCards.length >= 4) {
                statCards[0].querySelector('.stat-value').textContent = stats.totalStudents || '0';
                statCards[1].querySelector('.stat-value').textContent = stats.totalTeachers || '0';
                statCards[2].querySelector('.stat-value').textContent = stats.totalClasses || '0';
                statCards[3].querySelector('.stat-value').textContent = stats.attendanceRate || '0%';
            }
        }

        function setupNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    const section = this.dataset.section;
                    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                    document.getElementById(section + '-section').classList.add('active');
                    
                    document.getElementById('pageTitle').textContent = this.querySelector('span').textContent;
                });
            });
        }

        // Application Management Functions
        function reviewApplication(appId, studentName, grade, parentPhone, parentEmail) {
            Swal.fire({
                title: 'Review Application',
                html: `
                    <div style="text-align: left; max-height: 60vh; overflow-y: auto;">
                        <div style="background: linear-gradient(135deg, #dc2626, #b91c1c); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <h3>${studentName}</h3>
                            <p>Application ID: ${appId}</p>
                            <p>Grade Applied: ${grade}</p>
                        </div>
                        
                        <h4 style="margin-bottom: 10px;">Student Information:</h4>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <p><strong>Name:</strong> ${studentName}</p>
                            <p><strong>Date of Birth:</strong> March 15, 2013</p>
                            <p><strong>Gender:</strong> Male</p>
                            <p><strong>Grade Applied:</strong> ${grade}</p>
                            <p><strong>Previous School:</strong> Green Valley Primary</p>
                        </div>
                        
                        <h4 style="margin-bottom: 10px;">Parent/Guardian Information:</h4>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <p><strong>Name:</strong> Mr. & Mrs. Johnson</p>
                            <p><strong>Phone:</strong> ${parentPhone}</p>
                            <p><strong>Email:</strong> ${parentEmail}</p>
                            <p><strong>Address:</strong> Nairobi, Kenya</p>
                        </div>
                        
                        <h4 style="margin-bottom: 10px;">Uploaded Documents:</h4>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                            <p>✅ Birth Certificate</p>
                            <p>✅ Passport Photos (4)</p>
                            <p>✅ Immunization Records</p>
                            <p>✅ Parent ID Copy</p>
                            <p>✅ Previous School Records</p>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                showDenyButton: true,
                confirmButtonText: '<i class="fas fa-check"></i> Approve & Schedule Interview',
                denyButtonText: '<i class="fas fa-times"></i> Reject Application',
                cancelButtonText: 'Close',
                confirmButtonColor: '#059669',
                denyButtonColor: '#dc2626',
                width: 800
            }).then((result) => {
                if (result.isConfirmed) {
                    scheduleInterview(appId, studentName, parentEmail);
                } else if (result.isDenied) {
                    rejectApplication(appId, studentName, parentEmail);
                }
            });
        }

        function scheduleInterview(appId, studentName, parentEmail) {
            Swal.fire({
                title: 'Schedule Interview',
                html: `
                    <div style="text-align: left;">
                        <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <p><strong>Application:</strong> ${appId}</p>
                            <p><strong>Student:</strong> ${studentName}</p>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Interview Date *</label>
                            <input type="date" id="interviewDate" class="swal2-input" style="margin: 0;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Interview Time *</label>
                            <input type="time" id="interviewTime" class="swal2-input" style="margin: 0;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Interview Type *</label>
                            <select id="interviewType" class="swal2-input" style="margin: 0;">
                                <option value="in-person">In-Person</option>
                                <option value="online">Online (Video Call)</option>
                                <option value="phone">Phone Interview</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Interviewer *</label>
                            <select id="interviewer" class="swal2-input" style="margin: 0;">
                                <option value="">Select Interviewer</option>
                                <option>Head Teacher</option>
                                <option>Deputy Head</option>
                                <option>Class Teacher</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Location / Meeting Link</label>
                            <input type="text" id="interviewLocation" class="swal2-input" placeholder="e.g., Admin Office or Zoom link" style="margin: 0;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Instructions for Parent</label>
                            <textarea id="interviewInstructions" class="swal2-textarea" placeholder="Any special instructions..."></textarea>
                        </div>
                    </div>
                `,
                confirmButtonText: '<i class="fas fa-calendar-check"></i> Schedule Interview',
                showCancelButton: true,
                confirmButtonColor: '#059669',
                width: 650,
                preConfirm: () => {
                    const date = document.getElementById('interviewDate').value;
                    const time = document.getElementById('interviewTime').value;
                    const interviewer = document.getElementById('interviewer').value;
                    
                    if (!date || !time || !interviewer) {
                        Swal.showValidationMessage('Please fill all required fields');
                        return false;
                    }
                    
                    return { date, time, interviewer };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const data = result.value;
                    
                    Swal.fire({
                        title: 'Sending Notification...',
                        html: 'Scheduling interview and sending email to parent',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    
                    setTimeout(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Interview Scheduled! 📅',
                            html: `
                                <div style="text-align: left; background: #f8fafc; padding: 20px; border-radius: 12px;">
                                    <h4 style="margin-bottom: 15px;">Interview Details:</h4>
                                    <p><strong>Student:</strong> ${studentName}</p>
                                    <p><strong>Date:</strong> ${new Date(data.date).toLocaleDateString()}</p>
                                    <p><strong>Time:</strong> ${data.time}</p>
                                    <p><strong>Interviewer:</strong> ${data.interviewer}</p>
                                    
                                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #059669;">
                                        <p style="color: #047857;">
                                            <i class="fas fa-check-circle"></i> Application approved<br>
                                            <i class="fas fa-envelope"></i> Email sent to ${parentEmail}<br>
                                            <i class="fas fa-sms"></i> SMS sent to ${parentPhone}<br>
                                            <i class="fas fa-calendar"></i> Interview scheduled successfully
                                        </p>
                                    </div>
                                    
                                    <div style="background: #dbeafe; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #0891b2;">
                                        <small style="color: #0369a1;">
                                            <i class="fas fa-info-circle"></i> Parent will receive an email with:
                                            • Interview date, time, and location
                                            • What to bring
                                            • Directions to school
                                        </small>
                                    </div>
                                </div>
                            `,
                            confirmButtonColor: '#059669',
                            width: 700
                        });
                    }, 2000);
                }
            });
        }

        function rejectApplication(appId, studentName, parentEmail) {
            Swal.fire({
                title: 'Reject Application',
                html: `
                    <div style="text-align: left;">
                        <div style="background: #fef2f2; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #dc2626;">
                            <p><strong>Application:</strong> ${appId}</p>
                            <p><strong>Student:</strong> ${studentName}</p>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Reason for Rejection *</label>
                            <select id="rejectionReason" class="swal2-input" style="margin: 0;">
                                <option value="">Select Reason</option>
                                <option>Age requirement not met</option>
                                <option>Incomplete documentation</option>
                                <option>Class full - No available slots</option>
                                <option>Does not meet admission criteria</option>
                                <option>Other</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Additional Message to Parent</label>
                            <textarea id="rejectionMessage" class="swal2-textarea" placeholder="Provide additional information or suggestions..."></textarea>
                        </div>
                        
                        <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #f59e0b;">
                            <small style="color: #78350f;">
                                <i class="fas fa-info-circle"></i> An automated email will be sent to the parent explaining the rejection.
                            </small>
                        </div>
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc2626',
                confirmButtonText: 'Reject & Send Email',
                cancelButtonText: 'Cancel',
                width: 650,
                preConfirm: () => {
                    const reason = document.getElementById('rejectionReason').value;
                    if (!reason) {
                        Swal.showValidationMessage('Please select a reason');
                        return false;
                    }
                    return {
                        reason,
                        message: document.getElementById('rejectionMessage').value
                    };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: 'Sending Notification...',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    
                    setTimeout(() => {
                        Swal.fire({
                            icon: 'info',
                            title: 'Application Rejected',
                            html: `
                                <p>The application has been rejected and the parent has been notified.</p>
                                <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-top: 15px;">
                                    <p style="color: #64748b;">
                                        <i class="fas fa-envelope"></i> Email sent to ${parentEmail}<br>
                                        <i class="fas fa-sms"></i> SMS notification sent<br>
                                        <i class="fas fa-info-circle"></i> Reason: ${result.value.reason}
                                    </p>
                                </div>
                            `,
                            confirmButtonColor: '#059669'
                        });
                    }, 1500);
                }
            });
        }

        function conductInterview(appId, studentName) {
            Swal.fire({
                title: 'Interview Result',
                html: `
                    <div style="text-align: left;">
                        <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <p><strong>Application:</strong> ${appId}</p>
                            <p><strong>Student:</strong> ${studentName}</p>
                            <p><strong>Interview Date:</strong> Oct 8, 2025 at 10:00 AM</p>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Interview Result *</label>
                            <select id="interviewResult" class="swal2-input" style="margin: 0;">
                                <option value="">Select Result</option>
                                <option value="passed">✅ Passed - Admit Student</option>
                                <option value="failed">❌ Failed - Reject Application</option>
                                <option value="reschedule">🔄 Reschedule Interview</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Interview Score (Optional)</label>
                            <input type="number" id="interviewScore" class="swal2-input" placeholder="Score out of 100" min="0" max="100" style="margin: 0;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Interviewer Notes</label>
                            <textarea id="interviewNotes" class="swal2-textarea" placeholder="Notes from the interview..."></textarea>
                        </div>
                    </div>
                `,
                confirmButtonText: '<i class="fas fa-save"></i> Save Result',
                showCancelButton: true,
                confirmButtonColor: '#dc2626',
                width: 650,
                preConfirm: () => {
                    const result = document.getElementById('interviewResult').value;
                    if (!result) {
                        Swal.showValidationMessage('Please select interview result');
                        return false;
                    }
                    return {
                        result,
                        score: document.getElementById('interviewScore').value,
                        notes: document.getElementById('interviewNotes').value
                    };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const data = result.value;
                    
                    if (data.result === 'passed') {
                        admitStudent(appId, studentName);
                    } else if (data.result === 'failed') {
                        Swal.fire({
                            icon: 'info',
                            title: 'Application Rejected',
                            text: 'Parent has been notified via email',
                            confirmButtonColor: '#059669'
                        });
                    } else {
                        Swal.fire({
                            icon: 'info',
                            title: 'Interview Rescheduled',
                            text: 'Parent will be contacted to reschedule',
                            confirmButtonColor: '#059669'
                        });
                    }
                }
            });
        }

        function admitStudent(appId, studentName) {
            Swal.fire({
                title: 'Admit Student',
                html: `
                    <div style="text-align: left;">
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #059669;">
                            <p><strong>✅ Interview Passed!</strong></p>
                            <p>${studentName} has passed the interview and is ready to be admitted.</p>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Assign Class *</label>
                            <select id="assignClass" class="swal2-input" style="margin: 0;">
                                <option value="">Select Class</option>
                                <option>Grade 5 - Stream A</option>
                                <option>Grade 5 - Stream B</option>
                                <option>Grade 4 - Stream A</option>
                                <option>Grade 3 - Stream A</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Admission Number *</label>
                            <input type="text" id="admissionNumber" class="swal2-input" placeholder="Auto-generated" value="2025${Math.floor(Math.random() * 1000)}" style="margin: 0;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Admission Date *</label>
                            <input type="date" id="admissionDate" class="swal2-input" style="margin: 0;" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Special Notes</label>
                            <textarea id="admissionNotes" class="swal2-textarea" placeholder="Any special notes or requirements..."></textarea>
                        </div>
                    </div>
                `,
                confirmButtonText: '<i class="fas fa-user-check"></i> Admit Student',
                showCancelButton: true,
                confirmButtonColor: '#059669',
                width: 650,
                preConfirm: () => {
                    const classAssigned = document.getElementById('assignClass').value;
                    const admNo = document.getElementById('admissionNumber').value;
                    
                    if (!classAssigned || !admNo) {
                        Swal.showValidationMessage('Please fill all required fields');
                        return false;
                    }
                    
                    return {
                        classAssigned,
                        admNo,
                        admissionDate: document.getElementById('admissionDate').value
                    };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const data = result.value;
                    
                    Swal.fire({
                        title: 'Processing...',
                        html: 'Creating student account and sending notifications',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    
                    setTimeout(() => {
                        const username = studentName.toLowerCase().replace(' ', '.');
                        const password = generateRandomPassword();
                        
                        Swal.fire({
                            icon: 'success',
                            title: 'Student Admitted Successfully! 🎉',
                            html: `
                                <div style="text-align: left; background: #f8fafc; padding: 20px; border-radius: 12px;">
                                    <h4 style="margin-bottom: 15px;">Admission Details:</h4>
                                    <p><strong>Student Name:</strong> ${studentName}</p>
                                    <p><strong>Admission Number:</strong> ${data.admNo}</p>
                                    <p><strong>Class Assigned:</strong> ${data.classAssigned}</p>
                                    <p><strong>Admission Date:</strong> ${new Date(data.admissionDate).toLocaleDateString()}</p>
                                    
                                    <div style="background: #dbeafe; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #0891b2;">
                                        <h5 style="margin-bottom: 10px;">Student Portal Login:</h5>
                                        <p><strong>Username:</strong> ${username}</p>
                                        <p><strong>Password:</strong> ${password}</p>
                                        <small style="color: #0369a1;">
                                            <i class="fas fa-info-circle"></i> These credentials have been sent to the parent's email
                                        </small>
                                    </div>
                                    
                                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #059669;">
                                        <p style="color: #047857;">
                                            <i class="fas fa-check-circle"></i> Student added to system<br>
                                            <i class="fas fa-user"></i> Student portal account created<br>
                                            <i class="fas fa-users"></i> Parent portal account created<br>
                                            <i class="fas fa-envelope"></i> Welcome email sent to parent<br>
                                            <i class="fas fa-bell"></i> All notifications sent successfully
                                        </p>
                                    </div>
                                </div>
                            `,
                            confirmButtonColor: '#059669',
                            confirmButtonText: '<i class="fas fa-print"></i> Print Admission Letter',
                            showCancelButton: true,
                            cancelButtonText: 'Close',
                            width: 750
                        }).then((printResult) => {
                            if (printResult.isConfirmed) {
                                window.print();
                            }
                        });
                    }, 2500);
                }
            });
        }

        // Review & Approve Marks
        function reviewMarks(id, exam, className, subject, teacher) {
            // Sample marks data for review
            const marksData = [
                { admNo: '2025001', name: 'John Smith', marks: 92, remarks: 'Excellent work' },
                { admNo: '2025002', name: 'Damaris Jaleny', marks: 88, remarks: 'Very good' },
                { admNo: '2025003', name: 'Victor Sam', marks: 85, remarks: 'Good effort' },
                { admNo: '2025004', name: 'George Bradox', remarks: 80, remarks: 'Well done' }
            ];
            
            Swal.fire({
                title: 'Review & Approve Marks',
                html: `
                    <div style="text-align: left;">
                        <div style="background: linear-gradient(135deg, #dc2626, #b91c1c); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">${exam} - ${className}</h4>
                            <p><strong>Subject:</strong> ${subject}</p>
                            <p><strong>Teacher:</strong> ${teacher}</p>
                            <p><strong>Students:</strong> ${marksData.length}</p>
                        </div>
                        
                        <div style="max-height: 400px; overflow-y: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8fafc;">
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e2e8f0;">Student</th>
                                        <th style="padding: 12px; text-align: center; border-bottom: 2px solid #e2e8f0;">Marks</th>
                                        <th style="padding: 12px; text-align: center; border-bottom: 2px solid #e2e8f0;">Grade</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${marksData.map(student => {
                                        let grade = student.marks >= 85 ? 'A' : student.marks >= 70 ? 'B' : student.marks >= 50 ? 'C' : 'D';
                                        return `
                                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                                <td style="padding: 12px;">${student.name}</td>
                                                <td style="padding: 12px; text-align: center;"><strong>${student.marks}/100</strong></td>
                                                <td style="padding: 12px; text-align: center;"><span style="background: #059669; color: white; padding: 4px 12px; border-radius: 12px;">${grade}</span></td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #f59e0b;">
                            <strong>Review Summary:</strong>
                            <p style="margin-top: 10px; color: #64748b;">
                                • Class Average: 86.25%<br>
                                • Highest: 92% (John Smith)<br>
                                • Lowest: 80% (George Bradox)<br>
                                • Pass Rate: 100%
                            </p>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '<i class="fas fa-check"></i> Approve Marks',
                cancelButtonText: '<i class="fas fa-times"></i> Reject',
                confirmButtonColor: '#059669',
                cancelButtonColor: '#dc2626',
                width: 800
            }).then((result) => {
                if (result.isConfirmed) {
                    approveMarks(id, exam, className, subject);
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    rejectMarks(id, teacher);
                }
            });
        }

        function approveMarks(id, exam, className, subject) {
            Swal.fire({
                title: 'Approve Marks?',
                html: `
                    <p>Once approved, the system will:</p>
                    <ul style="text-align: left; margin: 15px 0; color: #64748b;">
                        <li>Add these marks to student records</li>
                        <li>Calculate total marks when all subjects are approved</li>
                        <li>Generate rankings automatically</li>
                        <li>Notify teacher, students, and parents</li>
                    </ul>
                    <p style="color: #64748b; margin-top: 15px;">This action cannot be undone.</p>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#059669',
                confirmButtonText: 'Yes, Approve',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: 'Processing...',
                        html: 'Approving marks and updating records',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    
                    setTimeout(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Marks Approved! ✅',
                            html: `
                                <p><strong>${exam} - ${className} - ${subject}</strong></p>
                                <p style="margin-top: 15px; color: #64748b;">
                                    ✅ Marks added to student records<br>
                                    ✅ Students can now view their grades<br>
                                    ✅ Parents have been notified<br>
                                    ✅ Teacher has been notified<br>
                                </p>
                                <p style="margin-top: 15px; background: #f0fdf4; padding: 15px; border-radius: 8px; color: #047857;">
                                    <i class="fas fa-chart-bar"></i> Once all subjects are approved, you can generate the complete results sheet with rankings.
                                </p>
                            `,
                            confirmButtonColor: '#059669',
                            width: 600
                        });
                        
                        // Remove from pending list (simulate)
                        event.currentTarget.closest('tr').style.opacity = '0.3';
                        event.currentTarget.closest('tr').querySelector('.btn-enhanced').disabled = true;
                    }, 2000);
                }
            });
        }

        function rejectMarks(id, teacher) {
            Swal.fire({
                title: 'Reject Marks?',
                html: `
                    <div style="text-align: left;">
                        <p style="margin-bottom: 15px;">Please provide a reason for rejection:</p>
                        <textarea class="swal2-textarea" id="rejectionReason" placeholder="Explain why these marks are being rejected..." rows="4"></textarea>
                        <p style="margin-top: 15px; color: #64748b; font-size: 0.9rem;">
                            <i class="fas fa-info-circle"></i> ${teacher} will be notified and can resubmit corrected marks.
                        </p>
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc2626',
                confirmButtonText: 'Reject & Notify Teacher',
                preConfirm: () => {
                    const reason = document.getElementById('rejectionReason').value;
                    if (!reason) {
                        Swal.showValidationMessage('Please provide a reason');
                        return false;
                    }
                    return reason;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        icon: 'info',
                        title: 'Marks Rejected',
                        text: 'Teacher has been notified to review and resubmit',
                        confirmButtonColor: '#059669'
                    });
                }
            });
        }

        // Generate Class Results
        function generateClassResults() {
            const exam = document.getElementById('resultsExam').value;
            const classId = document.getElementById('resultsClass').value;
            
            if (!exam || !classId) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Selection Required',
                    text: 'Please select both exam and class',
                    confirmButtonColor: '#dc2626'
                });
                return;
            }
            
            // Open results generator
            window.open('class-results-generator.html', '_blank');
        }

        function goToApplications() {
            document.querySelector('[data-section="applications"]').click();
        }

        function goToApprovals() {
            document.querySelector('[data-section="approvals"]').click();
        }

        function generateResults() {
            document.querySelector('[data-section="results"]').click();
        }

        async function addStudent() {
            // Check permission
            if (!window.authService.hasPermission('students', 'create')) {
                window.routeGuard.showAccessDenied();
                return;
            }

            Swal.fire({
                title: 'Add New Student',
                html: `
                    <div style="text-align: left; max-height: 70vh; overflow-y: auto;">
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Student Information</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="text" id="studentFirstName" class="swal2-input" placeholder="First Name *" required>
                                <input type="text" id="studentLastName" class="swal2-input" placeholder="Last Name *" required>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="text" id="studentMiddleName" class="swal2-input" placeholder="Middle Name">
                                <input type="date" id="studentDOB" class="swal2-input" placeholder="Date of Birth *" required>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <select id="studentGender" class="swal2-input" required>
                                    <option value="">Select Gender *</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                    </select>
                                <input type="text" id="studentNationality" class="swal2-input" placeholder="Nationality *" required>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="text" id="studentID" class="swal2-input" placeholder="National ID (if applicable)">
                                <select id="studentReligion" class="swal2-input">
                                    <option value="">Select Religion</option>
                                    <option value="christian">Christian</option>
                                    <option value="muslim">Muslim</option>
                                    <option value="hindu">Hindu</option>
                                    <option value="other">Other</option>
                                    <option value="none">None</option>
                                </select>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Academic Information</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <select id="studentGrade" class="swal2-input" required>
                                    <option value="">Select Grade *</option>
                                    <option value="nursery">Nursery (Age 3-4)</option>
                                    <option value="kindergarten">Kindergarten (Age 4-5)</option>
                                    <option value="grade1">Grade 1 (Age 6-7)</option>
                                    <option value="grade2">Grade 2</option>
                                    <option value="grade3">Grade 3</option>
                                    <option value="grade4">Grade 4</option>
                                    <option value="grade5">Grade 5</option>
                                    <option value="grade6">Grade 6</option>
                                </select>
                                <select id="academicYear" class="swal2-input" required>
                                    <option value="">Academic Year *</option>
                                    <option value="2024">2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                </select>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="text" id="previousSchool" class="swal2-input" placeholder="Previous School">
                                <select id="previousGrade" class="swal2-input">
                                    <option value="">Previous Grade</option>
                                    <option value="nursery">Nursery</option>
                                    <option value="kindergarten">Kindergarten</option>
                                    <option value="grade1">Grade 1</option>
                                    <option value="grade2">Grade 2</option>
                                    <option value="grade3">Grade 3</option>
                                    <option value="grade4">Grade 4</option>
                                    <option value="grade5">Grade 5</option>
                                    <option value="grade6">Grade 6</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <select id="specialNeeds" class="swal2-input">
                                    <option value="">Special Educational Needs</option>
                                    <option value="none">None</option>
                                    <option value="learning_disability">Learning Disability</option>
                                    <option value="physical_disability">Physical Disability</option>
                                    <option value="speech_therapy">Speech Therapy</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <textarea id="specialNeedsDesc" class="swal2-input" placeholder="Special Needs Description (if applicable)" style="height: 60px; resize: vertical;"></textarea>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Parent/Guardian Information</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="text" id="parentFirstName" class="swal2-input" placeholder="Parent First Name *" required>
                                <input type="text" id="parentLastName" class="swal2-input" placeholder="Parent Last Name *" required>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="tel" id="parentPhone" class="swal2-input" placeholder="Phone Number *" required>
                                <input type="email" id="parentEmail" class="swal2-input" placeholder="Email Address *" required>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="text" id="parentOccupation" class="swal2-input" placeholder="Occupation">
                                <select id="parentRelationship" class="swal2-input" required>
                                    <option value="">Relationship to Student *</option>
                                    <option value="father">Father</option>
                                    <option value="mother">Mother</option>
                                    <option value="guardian">Guardian</option>
                                    <option value="grandparent">Grandparent</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <textarea id="parentAddress" class="swal2-input" placeholder="Home Address *" required style="height: 60px; resize: vertical;"></textarea>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Health & Emergency Information</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <select id="bloodType" class="swal2-input">
                                    <option value="">Blood Type</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                    <option value="unknown">Unknown</option>
                                </select>
                                <input type="text" id="emergencyContact" class="swal2-input" placeholder="Emergency Contact Name">
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="tel" id="emergencyPhone" class="swal2-input" placeholder="Emergency Contact Phone">
                                <select id="transportation" class="swal2-input">
                                    <option value="">Transportation Method</option>
                                    <option value="parent_dropoff">Parent Drop-off</option>
                                    <option value="school_bus">School Bus</option>
                                    <option value="public_transport">Public Transport</option>
                                    <option value="walking">Walking</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <textarea id="medicalConditions" class="swal2-input" placeholder="Medical Conditions/Allergies" style="height: 60px; resize: vertical;"></textarea>
                        </div>
                    </div>
                `,
                confirmButtonText: 'Add Student',
                showCancelButton: true,
                confirmButtonColor: '#1e3a8a',
                cancelButtonColor: '#6b7280',
                width: 800,
                preConfirm: () => {
                    // Validate required fields
                    const firstName = document.getElementById('studentFirstName').value;
                    const lastName = document.getElementById('studentLastName').value;
                    const dob = document.getElementById('studentDOB').value;
                    const gender = document.getElementById('studentGender').value;
                    const nationality = document.getElementById('studentNationality').value;
                    const grade = document.getElementById('studentGrade').value;
                    const academicYear = document.getElementById('academicYear').value;
                    const parentFirstName = document.getElementById('parentFirstName').value;
                    const parentLastName = document.getElementById('parentLastName').value;
                    const parentPhone = document.getElementById('parentPhone').value;
                    const parentEmail = document.getElementById('parentEmail').value;
                    const parentRelationship = document.getElementById('parentRelationship').value;
                    const address = document.getElementById('parentAddress').value;

                    if (!firstName || !lastName || !dob || !gender || !nationality || !grade || !academicYear || 
                        !parentFirstName || !parentLastName || !parentPhone || !parentEmail || !parentRelationship || !address) {
                        Swal.showValidationMessage('Please fill in all required fields');
                        return false;
                    }

                    // Return form data
                    return {
                        firstName: firstName,
                        lastName: lastName,
                        middleName: document.getElementById('studentMiddleName').value,
                        dateOfBirth: dob,
                        gender: gender,
                        nationality: nationality,
                        idNumber: document.getElementById('studentID').value,
                        religion: document.getElementById('studentReligion').value,
                        grade: grade,
                        academicYear: academicYear,
                        previousSchool: document.getElementById('previousSchool').value,
                        previousGrade: document.getElementById('previousGrade').value,
                        specialNeeds: document.getElementById('specialNeeds').value,
                        specialNeedsDesc: document.getElementById('specialNeedsDesc').value,
                        parentFirstName: parentFirstName,
                        parentLastName: parentLastName,
                        parentPhone: parentPhone,
                        parentEmail: parentEmail,
                        parentOccupation: document.getElementById('parentOccupation').value,
                        parentRelationship: parentRelationship,
                        address: address,
                        bloodType: document.getElementById('bloodType').value,
                        emergencyContact: document.getElementById('emergencyContact').value,
                        emergencyPhone: document.getElementById('emergencyPhone').value,
                        transportation: document.getElementById('transportation').value,
                        medicalConditions: document.getElementById('medicalConditions').value
                    };
                }
            }).then(async (result) => {
                if (result.isConfirmed && result.value) {
                    try {
                        // Process the form data
                        const studentData = result.value;
                        studentData.fullName = `${studentData.firstName} ${studentData.lastName}`;
                        studentData.parentFullName = `${studentData.parentFirstName} ${studentData.parentLastName}`;
                        studentData.status = 'Active';
                        studentData.admissionNumber = 'KS' + Date.now().toString().slice(-6);
                        
                        // Simulate student addition (demo mode)
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        Swal.fire('Success!', 'Student added successfully (Demo Mode)', 'success');
                        
                        // Refresh the students table
                        await loadDashboardData();
                        
                    } catch (error) {
                        console.error('Error adding student:', error);
                        Swal.fire('Error', error.message || 'Failed to add student', 'error');
                    }
                }
            });
        }

        function addPayment() {
            Swal.fire({
                title: 'Record Fee Payment',
                html: `
                    <div style="text-align: left; max-height: 70vh; overflow-y: auto;">
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Student Selection</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <select id="studentSelect" class="swal2-input" required>
                                    <option value="">Select Student *</option>
                                    <option value="KS001">John Smith - STD 8A</option>
                                    <option value="KS002">Sarah Smith - STD 6B</option>
                                    <option value="KS003">Michael Johnson - STD 7A</option>
                                    <option value="KS004">Emily Davis - STD 5A</option>
                                    <option value="KS005">David Wilson - STD 4B</option>
                                    <option value="KS006">Lisa Brown - STD 3A</option>
                                    <option value="KS007">James Miller - STD 2B</option>
                                    <option value="KS008">Anna Garcia - STD 1A</option>
                                </select>
                                <input type="text" id="studentName" class="swal2-input" placeholder="Student Name (auto-filled)" readonly>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="text" id="studentClass" class="swal2-input" placeholder="Class (auto-filled)" readonly>
                                <input type="text" id="studentAdmission" class="swal2-input" placeholder="Admission No (auto-filled)" readonly>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Payment Details</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="number" id="paymentAmount" class="swal2-input" placeholder="Payment Amount (KES) *" required min="1">
                                <select id="paymentMethod" class="swal2-input" required>
                                    <option value="">Payment Method *</option>
                                    <option value="cash">Cash</option>
                                    <option value="bank_transfer">Bank Transfer</option>
                                    <option value="mpesa">M-Pesa</option>
                                    <option value="cheque">Cheque</option>
                                    <option value="card">Card Payment</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="date" id="paymentDate" class="swal2-input" required>
                                <select id="paymentTerm" class="swal2-input" required>
                                    <option value="">Payment Term *</option>
                                    <option value="term1">Term 1 Fees</option>
                                    <option value="term2">Term 2 Fees</option>
                                    <option value="term3">Term 3 Fees</option>
                                    <option value="annual">Annual Fees</option>
                                    <option value="transport">Transport Fees</option>
                                    <option value="lunch">Lunch Fees</option>
                                    <option value="uniform">Uniform Fees</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="text" id="referenceNumber" class="swal2-input" placeholder="Reference Number (M-Pesa/Transfer)">
                                <input type="text" id="receiptNumber" class="swal2-input" placeholder="Receipt Number (auto-generated)" readonly>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Fee Breakdown</h4>
                            <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>Total Fees Due:</span>
                                    <strong id="totalFees">KES 0</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>Previously Paid:</span>
                                    <span id="previouslyPaid">KES 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; border-top: 1px solid #e2e8f0; padding-top: 8px;">
                                    <span>Outstanding Balance:</span>
                                    <strong id="outstandingBalance" style="color: #dc2626;">KES 0</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; border-top: 1px solid #e2e8f0; padding-top: 8px;">
                                    <span>This Payment:</span>
                                    <strong id="thisPayment" style="color: #059669;">KES 0</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; border-top: 2px solid #1e3a8a; padding-top: 8px; font-weight: bold;">
                                    <span>New Balance:</span>
                                    <strong id="newBalance" style="color: #1e3a8a;">KES 0</strong>
                                </div>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Additional Information</h4>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Payment Notes:</label>
                                <textarea id="paymentNotes" class="swal2-input" placeholder="Additional notes about this payment..." style="height: 60px; resize: vertical;"></textarea>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="sendReceipt" checked>
                                    <span>Send receipt to parent</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="markAsComplete">
                                    <span>Mark term as complete</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `,
                confirmButtonText: 'Record Payment',
                showCancelButton: true,
                confirmButtonColor: '#059669',
                cancelButtonColor: '#6b7280',
                width: 900,
                didOpen: () => {
                    // Set default payment date to today
                    document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
                    
                    // Generate receipt number
                    const receiptNumber = 'RCP' + Date.now().toString().slice(-8);
                    document.getElementById('receiptNumber').value = receiptNumber;
                    
                    // Add event listeners
                    document.getElementById('studentSelect').addEventListener('change', function() {
                        updateStudentInfo(this.value);
                    });
                    
                    document.getElementById('paymentAmount').addEventListener('input', function() {
                        updatePaymentBreakdown();
                    });
                },
                preConfirm: () => {
                    // Validate required fields
                    const student = document.getElementById('studentSelect').value;
                    const amount = document.getElementById('paymentAmount').value;
                    const method = document.getElementById('paymentMethod').value;
                    const date = document.getElementById('paymentDate').value;
                    const term = document.getElementById('paymentTerm').value;

                    if (!student || !amount || !method || !date || !term) {
                        Swal.showValidationMessage('Please fill in all required fields');
                        return false;
                    }

                    if (parseFloat(amount) <= 0) {
                        Swal.showValidationMessage('Payment amount must be greater than 0');
                        return false;
                    }

                    // Return payment data
                    return {
                        studentId: student,
                        studentName: document.getElementById('studentName').value,
                        studentClass: document.getElementById('studentClass').value,
                        admissionNumber: document.getElementById('studentAdmission').value,
                        amount: parseFloat(amount),
                        method: method,
                        date: date,
                        term: term,
                        referenceNumber: document.getElementById('referenceNumber').value,
                        receiptNumber: document.getElementById('receiptNumber').value,
                        notes: document.getElementById('paymentNotes').value,
                        sendReceipt: document.getElementById('sendReceipt').checked,
                        markAsComplete: document.getElementById('markAsComplete').checked
                    };
                }
            }).then((result) => {
                if (result.isConfirmed && result.value) {
                    // Process the payment data
                    const paymentData = result.value;
                    paymentData.id = 'PAY' + Date.now().toString().slice(-8);
                    paymentData.status = 'completed';
                    paymentData.recordedBy = 'Admin'; // In real app, get from session
                    paymentData.recordedAt = new Date().toISOString();
                    
                    console.log('Recording payment:', paymentData);
                    
                    // Here you would typically send the data to your backend API
                    // For now, we'll just show success message
                    Swal.fire('Success!', `Payment of KES ${paymentData.amount.toLocaleString()} recorded successfully`, 'success');
                    
                    // Refresh the fees table if it exists
                    if (typeof loadFeesData === 'function') {
                        loadFeesData();
                    }
                }
            });
        }

        function updateStudentInfo(studentId) {
            // Mock student data - in real app, fetch from API
            const students = {
                'KS001': { name: 'John Smith', class: 'STD 8A', admission: 'KS001', totalFees: 30000, paid: 30000 },
                'KS002': { name: 'Sarah Smith', class: 'STD 6B', admission: 'KS002', totalFees: 25000, paid: 20000 },
                'KS003': { name: 'Michael Johnson', class: 'STD 7A', admission: 'KS003', totalFees: 28000, paid: 15000 },
                'KS004': { name: 'Emily Davis', class: 'STD 5A', admission: 'KS004', totalFees: 22000, paid: 10000 },
                'KS005': { name: 'David Wilson', class: 'STD 4B', admission: 'KS005', totalFees: 20000, paid: 5000 },
                'KS006': { name: 'Lisa Brown', class: 'STD 3A', admission: 'KS006', totalFees: 18000, paid: 0 },
                'KS007': { name: 'James Miller', class: 'STD 2B', admission: 'KS007', totalFees: 16000, paid: 8000 },
                'KS008': { name: 'Anna Garcia', class: 'STD 1A', admission: 'KS008', totalFees: 15000, paid: 15000 }
            };
            
            if (studentId && students[studentId]) {
                const student = students[studentId];
                document.getElementById('studentName').value = student.name;
                document.getElementById('studentClass').value = student.class;
                document.getElementById('studentAdmission').value = student.admission;
                
                // Update fee breakdown
                document.getElementById('totalFees').textContent = `KES ${student.totalFees.toLocaleString()}`;
                document.getElementById('previouslyPaid').textContent = `KES ${student.paid.toLocaleString()}`;
                document.getElementById('outstandingBalance').textContent = `KES ${(student.totalFees - student.paid).toLocaleString()}`;
                
                updatePaymentBreakdown();
            }
        }

        function updatePaymentBreakdown() {
            const paymentAmount = parseFloat(document.getElementById('paymentAmount').value) || 0;
            const totalFees = 30000; // This would come from student data
            const previouslyPaid = 20000; // This would come from student data
            const outstandingBalance = totalFees - previouslyPaid;
            const newBalance = outstandingBalance - paymentAmount;
            
            document.getElementById('thisPayment').textContent = `KES ${paymentAmount.toLocaleString()}`;
            document.getElementById('newBalance').textContent = `KES ${newBalance.toLocaleString()}`;
            
            // Update colors based on balance
            const newBalanceElement = document.getElementById('newBalance');
            if (newBalance <= 0) {
                newBalanceElement.style.color = '#059669';
                newBalanceElement.textContent = 'PAID IN FULL';
            } else if (newBalance < outstandingBalance) {
                newBalanceElement.style.color = '#f59e0b';
            } else {
                newBalanceElement.style.color = '#dc2626';
            }
        }

        function viewPaymentHistory(studentId) {
            // Mock payment history data
            const paymentHistory = {
                'KS001': [
                    { date: '2024-01-15', amount: 10000, method: 'M-Pesa', term: 'Term 1', receipt: 'RCP00123456', status: 'Completed' },
                    { date: '2024-01-10', amount: 10000, method: 'Bank Transfer', term: 'Term 1', receipt: 'RCP00123455', status: 'Completed' },
                    { date: '2024-01-05', amount: 10000, method: 'Cash', term: 'Term 1', receipt: 'RCP00123454', status: 'Completed' }
                ],
                'KS002': [
                    { date: '2024-01-10', amount: 10000, method: 'M-Pesa', term: 'Term 1', receipt: 'RCP00123453', status: 'Completed' },
                    { date: '2024-01-05', amount: 10000, method: 'Bank Transfer', term: 'Term 1', receipt: 'RCP00123452', status: 'Completed' }
                ],
                'KS003': [
                    { date: '2024-01-08', amount: 10000, method: 'Cash', term: 'Term 1', receipt: 'RCP00123451', status: 'Completed' },
                    { date: '2024-01-03', amount: 5000, method: 'M-Pesa', term: 'Term 1', receipt: 'RCP00123450', status: 'Completed' }
                ],
                'KS004': [
                    { date: '2024-01-05', amount: 10000, method: 'Bank Transfer', term: 'Term 1', receipt: 'RCP00123449', status: 'Completed' }
                ],
                'KS005': [
                    { date: '2024-01-03', amount: 5000, method: 'M-Pesa', term: 'Term 1', receipt: 'RCP00123448', status: 'Completed' }
                ],
                'KS006': []
            };

            const history = paymentHistory[studentId] || [];
            const studentNames = {
                'KS001': 'John Smith',
                'KS002': 'Sarah Smith', 
                'KS003': 'Michael Johnson',
                'KS004': 'Emily Davis',
                'KS005': 'David Wilson',
                'KS006': 'Lisa Brown'
            };

            let historyHtml = '';
            if (history.length > 0) {
                historyHtml = `
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                                    <th style="padding: 10px; text-align: left;">Date</th>
                                    <th style="padding: 10px; text-align: left;">Amount</th>
                                    <th style="padding: 10px; text-align: left;">Method</th>
                                    <th style="padding: 10px; text-align: left;">Term</th>
                                    <th style="padding: 10px; text-align: left;">Receipt</th>
                                    <th style="padding: 10px; text-align: left;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${history.map(payment => `
                                    <tr style="border-bottom: 1px solid #e2e8f0;">
                                        <td style="padding: 10px;">${new Date(payment.date).toLocaleDateString()}</td>
                                        <td style="padding: 10px; font-weight: bold; color: #059669;">KES ${payment.amount.toLocaleString()}</td>
                                        <td style="padding: 10px;">${payment.method}</td>
                                        <td style="padding: 10px;">${payment.term}</td>
                                        <td style="padding: 10px; font-family: monospace;">${payment.receipt}</td>
                                        <td style="padding: 10px;">
                                            <span style="background: #dcfce7; color: #166534; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                                                ${payment.status}
                                            </span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                historyHtml = `
                    <div style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-receipt" style="font-size: 3rem; margin-bottom: 20px; color: #d1d5db;"></i>
                        <h4>No Payment History</h4>
                        <p>No payments have been recorded for this student yet.</p>
                    </div>
                `;
            }

            Swal.fire({
                title: `${studentNames[studentId]} - Payment History`,
                html: historyHtml,
                width: 800,
                showConfirmButton: true,
                confirmButtonText: 'Close',
                confirmButtonColor: '#1e3a8a'
            });
        }

        function generateStudentTranscript() {
            Swal.fire({
                title: 'Generate Student Transcript',
                html: `
                    <div style="text-align: left; max-height: 70vh; overflow-y: auto;">
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Student Selection</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <select id="transcriptStudentSelect" class="swal2-input" required>
                                    <option value="">Select Student *</option>
                                    <option value="KS001">John Smith - STD 8A</option>
                                    <option value="KS002">Sarah Smith - STD 6B</option>
                                    <option value="KS003">Michael Johnson - STD 7A</option>
                                    <option value="KS004">Emily Davis - STD 5A</option>
                                    <option value="KS005">David Wilson - STD 4B</option>
                                    <option value="KS006">Lisa Brown - STD 3A</option>
                                    <option value="KS007">James Miller - STD 2B</option>
                                    <option value="KS008">Anna Garcia - STD 1A</option>
                                </select>
                                <input type="text" id="transcriptStudentName" class="swal2-input" placeholder="Student Name (auto-filled)" readonly>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="text" id="transcriptStudentClass" class="swal2-input" placeholder="Class (auto-filled)" readonly>
                                <input type="text" id="transcriptStudentAdmission" class="swal2-input" placeholder="Admission No (auto-filled)" readonly>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Transcript Options</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <select id="transcriptPeriod" class="swal2-input" required>
                                    <option value="">Select Period *</option>
                                    <option value="current">Current Academic Year</option>
                                    <option value="all">All Academic Years</option>
                                    <option value="term1">Term 1 Only</option>
                                    <option value="term2">Term 2 Only</option>
                                    <option value="term3">Term 3 Only</option>
                                    <option value="custom">Custom Period</option>
                                </select>
                                <select id="transcriptFormat" class="swal2-input" required>
                                    <option value="">Select Format *</option>
                                    <option value="detailed">Detailed Transcript</option>
                                    <option value="summary">Summary Transcript</option>
                                    <option value="official">Official Transcript</option>
                                    <option value="unofficial">Unofficial Copy</option>
                                </select>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <input type="date" id="transcriptStartDate" class="swal2-input" placeholder="Start Date (if custom)">
                                <input type="date" id="transcriptEndDate" class="swal2-input" placeholder="End Date (if custom)">
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Include Sections</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="includeGrades" checked>
                                    <span>Academic Grades</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="includeAttendance" checked>
                                    <span>Attendance Records</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="includeBehavior" checked>
                                    <span>Behavior Records</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="includeExtracurricular" checked>
                                    <span>Extracurricular Activities</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="includeAwards" checked>
                                    <span>Awards & Achievements</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="includeComments" checked>
                                    <span>Teacher Comments</span>
                                </label>
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #1e3a8a; margin-bottom: 15px; border-bottom: 2px solid #ea580c; padding-bottom: 5px;">Additional Options</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="includeSignature" checked>
                                    <span>Include Principal Signature</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="includeSeal" checked>
                                    <span>Include School Seal</span>
                                </label>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Special Instructions:</label>
                                <textarea id="transcriptInstructions" class="swal2-input" placeholder="Any special instructions for the transcript..." style="height: 60px; resize: vertical;"></textarea>
                            </div>
                        </div>
                    </div>
                `,
                confirmButtonText: 'Generate Transcript',
                showCancelButton: true,
                confirmButtonColor: '#1e3a8a',
                cancelButtonColor: '#6b7280',
                width: 800,
                didOpen: () => {
                    // Add event listeners
                    document.getElementById('transcriptStudentSelect').addEventListener('change', function() {
                        updateTranscriptStudentInfo(this.value);
                    });
                    
                    document.getElementById('transcriptPeriod').addEventListener('change', function() {
                        toggleCustomDateFields(this.value);
                    });
                },
                preConfirm: () => {
                    // Validate required fields
                    const student = document.getElementById('transcriptStudentSelect').value;
                    const period = document.getElementById('transcriptPeriod').value;
                    const format = document.getElementById('transcriptFormat').value;

                    if (!student || !period || !format) {
                        Swal.showValidationMessage('Please fill in all required fields');
                        return false;
                    }

                    // Return transcript data
                    return {
                        studentId: student,
                        studentName: document.getElementById('transcriptStudentName').value,
                        studentClass: document.getElementById('transcriptStudentClass').value,
                        admissionNumber: document.getElementById('transcriptStudentAdmission').value,
                        period: period,
                        format: format,
                        startDate: document.getElementById('transcriptStartDate').value,
                        endDate: document.getElementById('transcriptEndDate').value,
                        includeGrades: document.getElementById('includeGrades').checked,
                        includeAttendance: document.getElementById('includeAttendance').checked,
                        includeBehavior: document.getElementById('includeBehavior').checked,
                        includeExtracurricular: document.getElementById('includeExtracurricular').checked,
                        includeAwards: document.getElementById('includeAwards').checked,
                        includeComments: document.getElementById('includeComments').checked,
                        includeSignature: document.getElementById('includeSignature').checked,
                        includeSeal: document.getElementById('includeSeal').checked,
                        instructions: document.getElementById('transcriptInstructions').value
                    };
                }
            }).then((result) => {
                if (result.isConfirmed && result.value) {
                    // Process the transcript data
                    const transcriptData = result.value;
                    transcriptData.id = 'TRN' + Date.now().toString().slice(-8);
                    transcriptData.generatedBy = 'Admin'; // In real app, get from session
                    transcriptData.generatedAt = new Date().toISOString();
                    
                    console.log('Generating transcript:', transcriptData);
                    
                    // Show preview modal
                    showTranscriptPreview(transcriptData);
                }
            });
        }

        function updateTranscriptStudentInfo(studentId) {
            // Mock student data - in real app, fetch from API
            const students = {
                'KS001': { name: 'John Smith', class: 'STD 8A', admission: 'KS001' },
                'KS002': { name: 'Sarah Smith', class: 'STD 6B', admission: 'KS002' },
                'KS003': { name: 'Michael Johnson', class: 'STD 7A', admission: 'KS003' },
                'KS004': { name: 'Emily Davis', class: 'STD 5A', admission: 'KS004' },
                'KS005': { name: 'David Wilson', class: 'STD 4B', admission: 'KS005' },
                'KS006': { name: 'Lisa Brown', class: 'STD 3A', admission: 'KS006' },
                'KS007': { name: 'James Miller', class: 'STD 2B', admission: 'KS007' },
                'KS008': { name: 'Anna Garcia', class: 'STD 1A', admission: 'KS008' }
            };
            
            if (studentId && students[studentId]) {
                const student = students[studentId];
                document.getElementById('transcriptStudentName').value = student.name;
                document.getElementById('transcriptStudentClass').value = student.class;
                document.getElementById('transcriptStudentAdmission').value = student.admission;
            }
        }

        function toggleCustomDateFields(period) {
            const startDateField = document.getElementById('transcriptStartDate');
            const endDateField = document.getElementById('transcriptEndDate');
            
            if (period === 'custom') {
                startDateField.required = true;
                endDateField.required = true;
                startDateField.style.display = 'block';
                endDateField.style.display = 'block';
            } else {
                startDateField.required = false;
                endDateField.required = false;
                startDateField.style.display = 'none';
                endDateField.style.display = 'none';
            }
        }

        function showTranscriptPreview(transcriptData) {
            // Mock transcript data matching the Maseno School format
            const mockTranscript = {
                student: {
                    name: transcriptData.studentName,
                    class: transcriptData.studentClass,
                    admission: transcriptData.admissionNumber,
                    dateOfBirth: '2010-05-15',
                    enrollmentDate: '2020-01-15',
                    kcpe: 396,
                    vap: 1.21
                },
                performance: {
                    streamPosition: 9,
                    totalPoints: '75/84',
                    overallPosition: '66/546',
                    meanGrade: 'A-',
                    improvement: '+12',
                    rankImprovement: '+4'
                },
                academicRecords: [
                    { subject: 'English', points: 11, deviation: '+4', grade: 'A-', rank: '4/72', comment: 'Very good work', teacher: 'Cosmas Maruko' },
                    { subject: 'Kiswahili', points: 10, deviation: '+2', grade: 'B+', rank: '21/72', comment: 'Zaidi ya wastani', teacher: 'Okatch George' },
                    { subject: 'Mathematics', points: 11, deviation: '+2', grade: 'A-', rank: '20/72', comment: 'Very good work', teacher: 'Patrick Mboya' },
                    { subject: 'Biology', points: 9, deviation: '+1', grade: 'B', rank: '17/72', comment: 'Good, can do better', teacher: 'Amadi Omondi Edward' },
                    { subject: 'Physics', points: 10, deviation: '+1', grade: 'B+', rank: '4/72', comment: 'Good work but aim higher', teacher: 'Antony Omuga' },
                    { subject: 'Chemistry', points: 9, deviation: '+2', grade: 'B', rank: '11/72', comment: 'Good, can do better', teacher: 'Kevin Ochieng Amuoyo' },
                    { subject: 'History and Government', points: 12, deviation: '+2', grade: 'A', rank: '1/72', comment: 'Excellent work', teacher: 'Kasera Emmanuel' },
                    { subject: 'Business Studies', points: 11, deviation: '-1', grade: 'A-', rank: '15/72', comment: 'Very good work', teacher: 'John Okoth Dp' }
                ],
                performanceHistory: [
                    { period: 'KCPE Average', score: 10 },
                    { period: 'F2 T2, 2019', score: 11 },
                    { period: 'F2 T3, 2019', score: 10 },
                    { period: 'F3 T1, 2020', score: 11 },
                    { period: 'F3 T2, 2020', score: 9 },
                    { period: 'F3 T3, 2020', score: 10 },
                    { period: 'F4 T1, 2021', score: 11 },
                    { period: 'F4 T2, 2021', score: 10 },
                    { period: 'F4 T3, 2021', score: 12 }
                ],
                attendance: {
                    totalDays: 180,
                    present: 175,
                    absent: 5,
                    percentage: 97.2
                },
                remarks: {
                    classTeacher: {
                        name: 'Kevin Ochieng Amuoyo',
                        title: 'Class Teacher',
                        comment: 'Excellent work, keep it up so as to improve further.'
                    },
                    principal: {
                        name: 'Peter Owino',
                        title: 'Chief Principal',
                        comment: 'Very good performance, pay closer attention to Biology in order to get a better grade.'
                    }
                }
            };

            let transcriptHtml = `
                <div style="max-height: 80vh; overflow-y: auto; text-align: left; font-family: Arial, sans-serif; background: white; padding: 20px;">
                    <!-- Header Section -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 3px solid #1e3a8a; padding-bottom: 15px;">
                        <div style="display: flex; align-items: center;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #1e3a8a, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                <span style="color: white; font-weight: bold; font-size: 1.2rem;">KS</span>
                            </div>
                            <div>
                                <h2 style="color: #1e3a8a; margin: 0; font-size: 1.8rem; font-weight: bold;">KING SOLOMON JUNIOR PRIMARY SCHOOL</h2>
                                <p style="margin: 5px 0; color: #6b7280; font-size: 0.9rem;">P.O BOX 120 HOMA BAY | 0720 456 789 | info@kingsolomonjunior.ac.ke</p>
                            </div>
                        </div>
                    </div>

                    <!-- Title Bar -->
                    <div style="background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: white; padding: 10px 20px; margin-bottom: 20px; text-align: center;">
                        <h3 style="margin: 0; font-size: 1.3rem; font-weight: bold;">ACADEMIC REPORT FORM - ${transcriptData.studentClass} - (${new Date().getFullYear()} TERM 3)</h3>
                    </div>

                    <!-- Student Information Section -->
                    <div style="display: flex; margin-bottom: 25px; background: #f8fafc; padding: 20px; border-radius: 8px;">
                        <div style="width: 80px; height: 80px; background: #e2e8f0; border-radius: 8px; margin-right: 20px; display: flex; align-items: center; justify-content: center;">
                            <span style="color: #6b7280; font-size: 2rem;">👤</span>
                        </div>
                        <div style="flex: 1;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <p style="margin: 5px 0; font-size: 1.1rem;"><strong>NAME:</strong> ${mockTranscript.student.name}</p>
                                    <p style="margin: 5px 0; font-size: 1.1rem;"><strong>ADMNO:</strong> ${mockTranscript.student.admission}</p>
                                    <p style="margin: 5px 0; font-size: 1.1rem;"><strong>FORM:</strong> ${mockTranscript.student.class}</p>
                                </div>
                                <div>
                                    <p style="margin: 5px 0; font-size: 1.1rem;"><strong>KCPE:</strong> ${mockTranscript.student.kcpe}</p>
                                    <p style="margin: 5px 0; font-size: 1.1rem;"><strong>VAP:</strong> ${mockTranscript.student.vap}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Performance Section -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #1e3a8a;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #1e3a8a;">${mockTranscript.performance.streamPosition}</div>
                            <div style="color: #6b7280; font-size: 0.9rem;">Stream Position</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #059669;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #059669;">${mockTranscript.performance.totalPoints}</div>
                            <div style="color: #6b7280; font-size: 0.9rem;">Total Points</div>
                            <div style="color: #059669; font-size: 0.8rem;">↗ ${mockTranscript.performance.improvement}</div>
                        </div>
                        <div style="background: #fef3c7; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #f59e0b;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #f59e0b;">${mockTranscript.performance.overallPosition}</div>
                            <div style="color: #6b7280; font-size: 0.9rem;">Overall Position</div>
                            <div style="color: #059669; font-size: 0.8rem;">↗ ${mockTranscript.performance.rankImprovement}</div>
                        </div>
                        <div style="background: #f3e8ff; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #8b5cf6;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #8b5cf6;">${mockTranscript.performance.meanGrade}</div>
                            <div style="color: #6b7280; font-size: 0.9rem;">Mean Grade</div>
                        </div>
                    </div>
            `;

            if (transcriptData.includeGrades) {
                transcriptHtml += `
                    <!-- Subject Performance Table -->
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1e3a8a; border-bottom: 2px solid #ea580c; padding-bottom: 8px; margin-bottom: 15px; font-size: 1.2rem;">Subject Performance</h4>
                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <thead>
                                <tr style="background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: white;">
                                    <th style="padding: 12px; text-align: left; font-weight: bold;">Subject</th>
                                    <th style="padding: 12px; text-align: center; font-weight: bold;">Points</th>
                                    <th style="padding: 12px; text-align: center; font-weight: bold;">Deviation</th>
                                    <th style="padding: 12px; text-align: center; font-weight: bold;">Grade</th>
                                    <th style="padding: 12px; text-align: center; font-weight: bold;">Rank</th>
                                    <th style="padding: 12px; text-align: left; font-weight: bold;">Comment</th>
                                    <th style="padding: 12px; text-align: left; font-weight: bold;">Teacher</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${mockTranscript.academicRecords.map((record, index) => `
                                    <tr style="background: ${index % 2 === 0 ? '#f8fafc' : 'white'}; border-bottom: 1px solid #e2e8f0;">
                                        <td style="padding: 12px; font-weight: 600; color: #1e3a8a;">${record.subject}</td>
                                        <td style="padding: 12px; text-align: center; font-weight: bold; color: #059669;">${record.points}</td>
                                        <td style="padding: 12px; text-align: center; font-weight: bold; color: ${record.deviation.startsWith('+') ? '#059669' : '#dc2626'};">${record.deviation}</td>
                                        <td style="padding: 12px; text-align: center; font-weight: bold; color: #1e3a8a;">${record.grade}</td>
                                        <td style="padding: 12px; text-align: center; color: #6b7280;">${record.rank}</td>
                                        <td style="padding: 12px; color: #6b7280; font-style: italic;">${record.comment}</td>
                                        <td style="padding: 12px; color: #6b7280; font-size: 0.9rem;">${record.teacher}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            if (transcriptData.includeAttendance) {
                transcriptHtml += `
                    <!-- Attendance Summary -->
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #1e3a8a; border-bottom: 2px solid #ea580c; padding-bottom: 8px; margin-bottom: 15px; font-size: 1.2rem;">Attendance Summary</h4>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                            <div style="background: #f0f9ff; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #1e3a8a;">
                                <div style="font-size: 2rem; font-weight: bold; color: #1e3a8a;">${mockTranscript.attendance.totalDays}</div>
                                <div style="color: #6b7280; font-size: 0.9rem;">Total Days</div>
                            </div>
                            <div style="background: #f0fdf4; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #059669;">
                                <div style="font-size: 2rem; font-weight: bold; color: #059669;">${mockTranscript.attendance.present}</div>
                                <div style="color: #6b7280; font-size: 0.9rem;">Present</div>
                            </div>
                            <div style="background: #fef2f2; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #dc2626;">
                                <div style="font-size: 2rem; font-weight: bold; color: #dc2626;">${mockTranscript.attendance.absent}</div>
                                <div style="color: #6b7280; font-size: 0.9rem;">Absent</div>
                            </div>
                            <div style="background: #f0f9ff; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #1e3a8a;">
                                <div style="font-size: 2rem; font-weight: bold; color: #1e3a8a;">${mockTranscript.attendance.percentage}%</div>
                                <div style="color: #6b7280; font-size: 0.9rem;">Attendance Rate</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Remarks Section
            transcriptHtml += `
                <!-- Remarks Section -->
                <div style="margin-bottom: 25px;">
                    <h4 style="color: #1e3a8a; border-bottom: 2px solid #ea580c; padding-bottom: 8px; margin-bottom: 15px; font-size: 1.2rem;">Remarks</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="background: #f8fafc; padding: 20px; border-radius: 8px; border-left: 4px solid #059669;">
                            <p style="margin: 0 0 10px 0; font-weight: bold; color: #1e3a8a;">${mockTranscript.remarks.classTeacher.name} - ${mockTranscript.remarks.classTeacher.title}</p>
                            <p style="margin: 0; color: #6b7280; font-style: italic;">"${mockTranscript.remarks.classTeacher.comment}"</p>
                            <div style="margin-top: 15px; height: 30px; border-bottom: 1px solid #e2e8f0;"></div>
                        </div>
                        <div style="background: #f8fafc; padding: 20px; border-radius: 8px; border-left: 4px solid #1e3a8a;">
                            <p style="margin: 0 0 10px 0; font-weight: bold; color: #1e3a8a;">${mockTranscript.remarks.principal.name} - ${mockTranscript.remarks.principal.title}</p>
                            <p style="margin: 0; color: #6b7280; font-style: italic;">"${mockTranscript.remarks.principal.comment}"</p>
                            <div style="margin-top: 15px; height: 30px; border-bottom: 1px solid #e2e8f0;"></div>
                        </div>
                    </div>
                </div>
            `;

            // Interactive Profile Section
            transcriptHtml += `
                <!-- Interactive Profile Section -->
                <div style="background: #f0f9ff; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 20px;">
                    <div style="width: 80px; height: 80px; background: #1e3a8a; margin: 0 auto 15px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: white; font-size: 1.5rem;">📱</span>
                    </div>
                    <p style="margin: 0; color: #6b7280; font-size: 0.9rem;">Scan to access your interactive student profile on King Solomon Analytics</p>
                    <p style="margin: 5px 0 0 0; color: #1e3a8a; font-weight: bold; font-size: 0.9rem;">Your username: ${mockTranscript.student.admission}@kingsolomonjunior.ac.ke</p>
                </div>
            `;

            // Footer
            transcriptHtml += `
                <!-- Footer -->
                <div style="background: linear-gradient(135deg, #059669, #047857); color: white; padding: 15px; text-align: center; border-radius: 8px;">
                    <p style="margin: 0; font-weight: bold; font-size: 1.1rem;">School Motto: Excellence Through Knowledge</p>
                </div>
            </div>
            `;

            Swal.fire({
                title: 'Academic Report Preview',
                html: transcriptHtml,
                width: 1200,
                showConfirmButton: true,
                showCancelButton: true,
                confirmButtonText: 'Download PDF',
                cancelButtonText: 'Close',
                confirmButtonColor: '#1e3a8a',
                cancelButtonColor: '#6b7280'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Here you would typically generate and download the PDF
                    Swal.fire('Success!', 'Academic Report PDF generated and downloaded successfully', 'success');
                }
            });
        }

        function setupUserDropdown() {
            const user = window.authService.getCurrentUser();
            if (user) {
                const userNameElement = document.querySelector('.user-name');
                if (userNameElement) {
                    userNameElement.textContent = `${user.first_name} ${user.last_name}`;
                }
            }
        }

        async function logout() {
            try {
                await window.authService.logout();
                Swal.fire({
                    title: 'Logged Out',
                    text: 'You have been successfully logged out.',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                }).then(() => {
                    window.location.href = '/login.html';
                });
            } catch (error) {
                console.error('Logout error:', error);
                // Force logout even if API call fails
                window.authService.clearSession();
                window.location.href = '/login.html';
            }
        }

        function showError(message) {
            Swal.fire({
                title: 'Error',
                text: message,
                icon: 'error',
                confirmButtonText: 'OK'
            });
        }

        function viewReports() {
            document.querySelector('[data-section="reports"]').click();
        }

        function viewStudentFull(name, admNo) {
            Swal.fire({
                title: name + ' - Complete Profile',
                html: `
                    <div style="text-align: left;">
                        <div style="background: linear-gradient(135deg, #dc2626, #b91c1c); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <h3>${name}</h3>
                            <p>Admission No: ${admNo}</p>
                        </div>
                        
                        <h4 style="margin-bottom: 15px;">Academic Performance:</h4>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <p><strong>Overall Grade:</strong> A- (92%)</p>
                            <p><strong>Class:</strong> STD 8 - Stream A</p>
                            <p><strong>Class Rank:</strong> 3rd out of 28</p>
                            <p><strong>Attendance:</strong> 98% (25 present, 1 absent)</p>
                            <p><strong>Assignments:</strong> 15/15 submitted</p>
                        </div>
                        
                        <h4 style="margin-bottom: 15px;">Parent Information:</h4>
                        <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <p><strong>Parent Name:</strong> Mr. & Mrs. Smith</p>
                            <p><strong>Email:</strong> parent@example.com</p>
                            <p><strong>Phone:</strong> +254 700 123 456</p>
                        </div>
                        
                        <h4 style="margin-bottom: 15px;">Fee Status:</h4>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px;">
                            <p><strong>Status:</strong> <span style="color: #059669;">Fully Paid</span></p>
                            <p><strong>Total Paid:</strong> KES 30,000</p>
                        </div>
                    </div>
                `,
                width: 700,
                confirmButtonText: 'Close',
                confirmButtonColor: '#dc2626'
            });
        }

        function addTeacher() {
            Swal.fire({
                title: 'Add New Teacher',
                html: `
                    <div style="text-align: left; max-height: 70vh; overflow-y: auto; padding: 10px;">
                        <!-- Personal Information -->
                        <h4 style="color: #dc2626; margin-bottom: 15px; border-bottom: 2px solid #dc2626; padding-bottom: 8px;">
                            <i class="fas fa-user"></i> 1. Personal Information
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                            <input type="text" id="teacherFirstName" class="swal2-input" placeholder="First Name *" style="margin: 0;">
                            <input type="text" id="teacherLastName" class="swal2-input" placeholder="Last Name *" style="margin: 0;">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <select id="teacherGender" class="swal2-input" style="margin: 0;">
                                <option value="">Select Gender *</option>
                                <option>Male</option>
                                <option>Female</option>
                            </select>
                            <input type="date" id="teacherDOB" class="swal2-input" placeholder="Date of Birth *" style="margin: 0;">
                        </div>
                        <input type="text" id="teacherID" class="swal2-input" placeholder="National ID / Passport Number *" style="margin-bottom: 10px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <input type="tel" id="teacherPhone" class="swal2-input" placeholder="Phone Number *" style="margin: 0;">
                            <input type="email" id="teacherEmail" class="swal2-input" placeholder="Email Address *" style="margin: 0;">
                        </div>
                        
                        <!-- Professional Details -->
                        <h4 style="color: #dc2626; margin: 25px 0 15px; border-bottom: 2px solid #dc2626; padding-bottom: 8px;">
                            <i class="fas fa-briefcase"></i> 2. Professional Details
                        </h4>
                        <input type="text" id="employeeNumber" class="swal2-input" placeholder="Employee Number (auto-generated if empty)" style="margin-bottom: 10px;">
                        <select id="qualification" class="swal2-input" style="margin-bottom: 10px;">
                            <option value="">Select Qualification *</option>
                            <option>Diploma in Education</option>
                            <option>Bachelor of Education (B.Ed)</option>
                            <option>Master of Education (M.Ed)</option>
                            <option>PhD in Education</option>
                            <option>Other</option>
                        </select>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem;">Subjects Taught (Hold Ctrl to select multiple) *</label>
                            <select id="subjectsTaught" class="swal2-input" multiple style="height: 100px; margin: 0;">
                                <option>Mathematics</option>
                                <option>English</option>
                                <option>Kiswahili</option>
                                <option>Science</option>
                                <option>Social Studies</option>
                                <option>Religious Education</option>
                                <option>Physical Education</option>
                                <option>Art & Craft</option>
                                <option>Music</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem;">Classes Assigned (Hold Ctrl to select multiple)</label>
                            <select id="classesAssigned" class="swal2-input" multiple style="height: 100px; margin: 0;">
                                <option>STD 8 - Stream A</option>
                                <option>STD 8 - Stream B</option>
                                <option>STD 7 - Stream A</option>
                                <option>STD 7 - Stream B</option>
                                <option>STD 6 - Stream A</option>
                                <option>STD 6 - Stream B</option>
                                <option>STD 5 - Stream A</option>
                                <option>STD 4 - Stream A</option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <input type="number" id="yearsExperience" class="swal2-input" placeholder="Years of Experience" min="0" style="margin: 0;">
                            <select id="employmentType" class="swal2-input" style="margin: 0;">
                                <option value="">Employment Type *</option>
                                <option>Full-time</option>
                                <option>Part-time</option>
                                <option>Contract</option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <input type="date" id="joiningDate" class="swal2-input" placeholder="Date of Employment *" style="margin: 0;">
                            <input type="text" id="tscNumber" class="swal2-input" placeholder="TSC Number (Kenya)" style="margin: 0;">
                        </div>
                        
                        <!-- Account Details -->
                        <h4 style="color: #dc2626; margin: 25px 0 15px; border-bottom: 2px solid #dc2626; padding-bottom: 8px;">
                            <i class="fas fa-key"></i> 3. Account Details
                        </h4>
                        <input type="text" id="username" class="swal2-input" placeholder="Username (auto-generated if empty)" style="margin-bottom: 10px;">
                        <input type="password" id="password" class="swal2-input" placeholder="Password (auto-generated if empty)" style="margin-bottom: 10px;">
                        <select id="teacherRole" class="swal2-input" style="margin-bottom: 10px;">
                            <option value="">Select Role *</option>
                            <option>Class Teacher</option>
                            <option>Subject Teacher</option>
                            <option>Deputy Head Teacher</option>
                            <option>Head of Department</option>
                        </select>
                        <select id="accessLevel" class="swal2-input" style="margin-bottom: 10px;">
                            <option value="">Access Level *</option>
                            <option>Subject-based Access</option>
                            <option>Class-based Access</option>
                            <option>Full Access</option>
                        </select>
                        
                        <!-- Contact & Address -->
                        <h4 style="color: #dc2626; margin: 25px 0 15px; border-bottom: 2px solid #dc2626; padding-bottom: 8px;">
                            <i class="fas fa-map-marker-alt"></i> 4. Contact & Address
                        </h4>
                        <textarea id="address" class="swal2-textarea" placeholder="Home Address" style="margin-bottom: 10px;"></textarea>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <input type="text" id="county" class="swal2-input" placeholder="County" style="margin: 0;">
                            <input type="text" id="subCounty" class="swal2-input" placeholder="Sub-county" style="margin: 0;">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <input type="text" id="emergencyName" class="swal2-input" placeholder="Emergency Contact Name" style="margin: 0;">
                            <input type="tel" id="emergencyPhone" class="swal2-input" placeholder="Emergency Contact Phone" style="margin: 0;">
                        </div>
                        
                        <!-- Additional -->
                        <h4 style="color: #dc2626; margin: 25px 0 15px; border-bottom: 2px solid #dc2626; padding-bottom: 8px;">
                            <i class="fas fa-file-alt"></i> 5. Additional Information
                        </h4>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem;">Upload CV / Certificates</label>
                            <input type="file" id="teacherDocuments" multiple accept=".pdf,.doc,.docx" style="padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; width: 100%;">
                            <small style="color: #64748b;">Accepted: PDF, DOC, DOCX</small>
                        </div>
                        <textarea id="remarks" class="swal2-textarea" placeholder="Remarks / Notes (optional)" style="margin-bottom: 10px;"></textarea>
                        <select id="teacherStatus" class="swal2-input" style="margin-bottom: 10px;">
                            <option value="active">Active</option>
                            <option value="leave">On Leave</option>
                            <option value="inactive">Inactive</option>
                        </select>
                        
                        <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #f59e0b;">
                            <small style="color: #78350f;">
                                <i class="fas fa-info-circle"></i> <strong>Note:</strong> Fields marked with * are required. 
                                Username and password will be auto-generated if left empty.
                            </small>
                        </div>
                    </div>
                `,
                confirmButtonText: '<i class="fas fa-user-plus"></i> Add Teacher',
                showCancelButton: true,
                confirmButtonColor: '#dc2626',
                cancelButtonText: 'Cancel',
                width: 800,
                customClass: {
                    container: 'teacher-form-modal'
                },
                preConfirm: () => {
                    const firstName = document.getElementById('teacherFirstName').value;
                    const lastName = document.getElementById('teacherLastName').value;
                    const gender = document.getElementById('teacherGender').value;
                    const phone = document.getElementById('teacherPhone').value;
                    const email = document.getElementById('teacherEmail').value;
                    const qualification = document.getElementById('qualification').value;
                    const subjects = document.getElementById('subjectsTaught').selectedOptions;
                    const employmentType = document.getElementById('employmentType').value;
                    const joiningDate = document.getElementById('joiningDate').value;
                    const role = document.getElementById('teacherRole').value;
                    const accessLevel = document.getElementById('accessLevel').value;
                    
                    if (!firstName || !lastName || !gender || !phone || !email || !qualification || subjects.length === 0 || !employmentType || !joiningDate || !role || !accessLevel) {
                        Swal.showValidationMessage('Please fill all required fields (marked with *)');
                        return false;
                    }
                    
                    return {
                        firstName,
                        lastName,
                        gender,
                        phone,
                        email,
                        qualification,
                        subjects: Array.from(subjects).map(opt => opt.value),
                        employmentType,
                        joiningDate,
                        role,
                        accessLevel
                    };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const data = result.value;
                    
                    // Generate auto credentials if not provided
                    const employeeNumber = document.getElementById('employeeNumber').value || 'TCH' + Date.now();
                    const username = document.getElementById('username').value || (data.firstName.toLowerCase() + '.' + data.lastName.toLowerCase());
                    const password = document.getElementById('password').value || generateRandomPassword();
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Teacher Added Successfully! 👨‍🏫',
                        html: `
                            <div style="text-align: left; background: #f8fafc; padding: 20px; border-radius: 12px;">
                                <h4 style="margin-bottom: 15px;">Teacher Details:</h4>
                                <p><strong>Name:</strong> ${data.firstName} ${data.lastName}</p>
                                <p><strong>Employee Number:</strong> ${employeeNumber}</p>
                                <p><strong>Subjects:</strong> ${data.subjects.join(', ')}</p>
                                <p><strong>Role:</strong> ${data.role}</p>
                                
                                <div style="background: #dbeafe; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #0891b2;">
                                    <h5 style="margin-bottom: 10px;">Login Credentials:</h5>
                                    <p><strong>Username:</strong> ${username}</p>
                                    <p><strong>Password:</strong> ${password}</p>
                                    <small style="color: #0369a1;">
                                        <i class="fas fa-info-circle"></i> Please share these credentials with the teacher. 
                                        They can change the password after first login.
                                    </small>
                                </div>
                                
                                <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #059669;">
                                    <p style="color: #047857;">
                                        <i class="fas fa-check-circle"></i> Teacher has been added to the system<br>
                                        <i class="fas fa-envelope"></i> Welcome email sent to ${data.email}<br>
                                        <i class="fas fa-bell"></i> Teacher can now access the teacher portal
                                    </p>
                                </div>
                            </div>
                        `,
                        confirmButtonColor: '#059669',
                        confirmButtonText: '<i class="fas fa-print"></i> Print Credentials',
                        showCancelButton: true,
                        cancelButtonText: 'Close',
                        width: 700
                    }).then((printResult) => {
                        if (printResult.isConfirmed) {
                            window.print();
                        }
                    });
                }
            });
        }

        function generateRandomPassword() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789';
            let password = '';
            for (let i = 0; i < 8; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password + '@' + Math.floor(Math.random() * 100);
        }

        function viewTeacher(name) {
            Swal.fire({
                title: name + ' - Teacher Profile',
                html: `
                    <div style="text-align: left;">
                        <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                            <p><strong>Subject:</strong> Mathematics</p>
                            <p><strong>Classes Taught:</strong> STD 8A, STD 7B, STD 6B</p>
                            <p><strong>Total Students:</strong> 85</p>
                            <p><strong>Email:</strong> m.johnson@ks.ac.ke</p>
                            <p><strong>Phone:</strong> +254 700 111 222</p>
                        </div>
                        
                        <h4 style="margin-bottom: 10px;">Performance Metrics:</h4>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px;">
                            <p><strong>Class Average:</strong> 87%</p>
                            <p><strong>Pass Rate:</strong> 98%</p>
                            <p><strong>Student Satisfaction:</strong> 4.8/5</p>
                        </div>
                    </div>
                `,
                width: 650,
                confirmButtonText: 'Close',
                confirmButtonColor: '#dc2626'
            });
        }

        function addClass() {
            Swal.fire({
                title: 'Add New Class',
                html: `
                    <input type="text" class="swal2-input" placeholder="Class Name (e.g., STD 5)">
                    <input type="text" class="swal2-input" placeholder="Stream (e.g., A)">
                    <input type="number" class="swal2-input" placeholder="Capacity">
                    <select class="swal2-input">
                        <option value="">Select Class Teacher</option>
                        <option>Mrs. Johnson</option>
                        <option>Mr. Davis</option>
                        <option>Ms. Williams</option>
                    </select>
                `,
                confirmButtonText: 'Add Class',
                showCancelButton: true,
                confirmButtonColor: '#dc2626'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Success!', 'Class added successfully', 'success');
                }
            });
        }

        function manageClass(className) {
            Swal.fire({
                title: `Manage ${className}`,
                html: `
                    <div style="text-align: left;">
                        <div style="background: linear-gradient(135deg, #dc2626, #b91c1c); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <h3>${className}</h3>
                            <p>Total Students: 85</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <button class="btn-enhanced" style="background: #059669; color: white; padding: 20px; justify-content: center;">
                                <i class="fas fa-users"></i><br>View Students
                            </button>
                            <button class="btn-enhanced" style="background: #0891b2; color: white; padding: 20px; justify-content: center;">
                                <i class="fas fa-chalkboard-teacher"></i><br>Assign Teachers
                            </button>
                            <button class="btn-enhanced" style="background: #f59e0b; color: white; padding: 20px; justify-content: center;">
                                <i class="fas fa-chart-bar"></i><br>Performance
                            </button>
                            <button class="btn-enhanced" style="background: #8b5cf6; color: white; padding: 20px; justify-content: center;">
                                <i class="fas fa-calendar"></i><br>Timetable
                            </button>
                        </div>
                    </div>
                `,
                showCloseButton: true,
                showConfirmButton: false,
                width: 600
            });
        }

        function generateReport(type) {
            const titles = {
                academic: 'Academic Performance Report',
                attendance: 'Attendance Report',
                financial: 'Financial Report',
                comprehensive: 'Comprehensive School Report'
            };
            
            Swal.fire({
                title: `Generate ${titles[type]}`,
                html: `
                    <div style="text-align: left;">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Period</label>
                            <select class="swal2-input">
                                <option>This Term</option>
                                <option>This Month</option>
                                <option>This Year</option>
                                <option>Custom Range</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Format</label>
                            <select class="swal2-input">
                                <option>PDF</option>
                                <option>Excel</option>
                                <option>Both</option>
                            </select>
                        </div>
                    </div>
                `,
                confirmButtonText: '<i class="fas fa-download"></i> Generate Report',
                showCancelButton: true,
                confirmButtonColor: '#dc2626'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: 'Generating...',
                        allowOutsideClick: false,
                        didOpen: () => { Swal.showLoading(); }
                    });
                    
                    setTimeout(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Report Ready! 📊',
                            html: '<button class="btn-enhanced" style="background: #059669; color: white;" onclick="window.print()">Download Now</button>',
                            confirmButtonColor: '#059669'
                        });
                    }, 1500);
                }
            });
        }

        function showNotifications() {
            Swal.fire({
                title: '🔔 Notifications',
                html: `
                    <div style="text-align: left;">
                        <div style="padding: 15px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 8px; margin-bottom: 10px;">
                            <strong>3 Marks Submissions Awaiting Approval</strong>
                            <p style="margin: 5px 0; color: #64748b;">From Mrs. Johnson and Mr. Davis</p>
                        </div>
                        <div style="padding: 15px; background: #f0fdf4; border-left: 4px solid #059669; border-radius: 8px; margin-bottom: 10px;">
                            <strong>Fee Collection Target Met!</strong>
                            <p style="margin: 5px 0; color: #64748b;">95% of term fees collected</p>
                        </div>
                    </div>
                `,
                showCloseButton: true,
                showConfirmButton: false
            });
        }

        function showUserMenu() {
            Swal.fire({
                title: 'Admin Menu',
                html: `
                    <button onclick="logout()" style="width: 100%; padding: 15px; background: white; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; text-align: left;">
                        <i class="fas fa-sign-out-alt" style="margin-right: 10px; color: #dc2626;"></i> Logout
                    </button>
                `,
                showConfirmButton: false,
                showCloseButton: true
            });
        }

        function logout() {
            Swal.close();
            Swal.fire({
                title: 'Logout?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes, logout',
                confirmButtonColor: '#dc2626'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = 'login.html';
                }
            });
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Initialize Charts
        document.addEventListener('DOMContentLoaded', function() {
            // Enrollment Chart
            new Chart(document.getElementById('enrollmentChart'), {
                type: 'line',
                data: {
                    labels: ['2021', '2022', '2023', '2024', '2025'],
                    datasets: [{
                        label: 'Total Students',
                        data: [250, 280, 310, 325, 340],
                        borderColor: '#dc2626',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Fee Collection
            new Chart(document.getElementById('feeCollectionChart'), {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Apr', 'Aug'],
                    datasets: [{
                        label: 'Collected (KES)',
                        data: [1200000, 1500000, 2500000],
                        backgroundColor: '#059669'
                    }, {
                        label: 'Pending (KES)',
                        data: [300000, 200000, 100000],
                        backgroundColor: '#f59e0b'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Performance
            new Chart(document.getElementById('performanceChart'), {
                type: 'doughnut',
                data: {
                    labels: ['A', 'B', 'C', 'D', 'F'],
                    datasets: [{
                        data: [30, 40, 20, 8, 2],
                        backgroundColor: ['#059669', '#10b981', '#f59e0b', '#dc2626', '#7f1d1d']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Class Distribution
            new Chart(document.getElementById('classDistributionChart'), {
                type: 'bar',
                data: {
                    labels: ['STD 8', 'STD 7', 'STD 6', 'STD 5', 'STD 4'],
                    datasets: [{
                        label: 'Students',
                        data: [85, 90, 75, 50, 40],
                        backgroundColor: ['#dc2626', '#f59e0b', '#059669', '#0891b2', '#8b5cf6'],
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Fee Trend Chart
            setTimeout(() => {
                const feesTrend = document.getElementById('feesTrendChart');
                if (feesTrend) {
                    new Chart(feesTrend, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug'],
                            datasets: [{
                                label: 'Collected',
                                data: [400000, 300000, 450000, 1200000, 200000, 350000, 400000, 2500000],
                                borderColor: '#059669',
                                backgroundColor: 'rgba(5, 150, 105, 0.1)',
                                fill: true,
                                tension: 0.4
                            }, {
                                label: 'Pending',
                                data: [100000, 150000, 80000, 300000, 120000, 90000, 100000, 500000],
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
            }, 500);

            // Analytics Charts
            setTimeout(() => {
                const classPerfChart = document.getElementById('classPerformanceChart');
                if (classPerfChart) {
                    new Chart(classPerfChart, {
                        type: 'line',
                        data: {
                            labels: ['Term 1', 'Term 2', 'Term 3'],
                            datasets: [{
                                label: 'STD 8',
                                data: [82, 85, 87],
                                borderColor: '#dc2626',
                                tension: 0.4
                            }, {
                                label: 'STD 7',
                                data: [75, 78, 80],
                                borderColor: '#059669',
                                tension: 0.4
                            }, {
                                label: 'STD 6',
                                data: [80, 83, 85],
                                borderColor: '#0891b2',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }

                const attendTrendChart = document.getElementById('attendanceTrendChart');
                if (attendTrendChart) {
                    new Chart(attendTrendChart, {
                        type: 'line',
                        data: {
                            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                            datasets: [{
                                label: 'Attendance %',
                                data: [94, 96, 95, 97],
                                borderColor: '#059669',
                                backgroundColor: 'rgba(5, 150, 105, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { beginAtZero: true, max: 100 }
                            }
                        }
                    });
                }
            }, 1000);

            // Welcome
            setTimeout(() => {
                Swal.fire({
                    title: 'Welcome, Admin! 👨‍💼',
                    text: '3 marks submissions awaiting approval',
                    icon: 'info',
                    timer: 3000,
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timerProgressBar: true
                });
            }, 500);
        });
    </script>
</body>
</html>
